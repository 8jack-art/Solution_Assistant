# 富文本编辑器方案评估

## 需求分析

### 核心需求
1. **LLM流式输出显示** - 支持增量内容追加、实时渲染、流畅的打字机效果
2. **Word文档导出** - 支持将编辑器内容导出为.docx格式
3. **富文本编辑** - 格式化、标题、列表、链接等功能
4. **稳定性** - 与现有技术栈兼容，无严重版本兼容性问题

### 当前问题
CKEditor5 v44.3.0与@ckeditor/ckeditor5-react v5.1.0存在根本性兼容性问题：
- IIFE格式导出导致`this.props.editor.create is not a function`错误
- 官方已不推荐使用预构建版本

---

## 方案对比评估

### 方案A：Tiptap + Word导出插件 ⭐ 推荐

**简介**
Tiptap是基于ProseMirror的现代富文本编辑器，Vue.js创始人开发，TypeScript支持优秀。

**优势**
| 特性 | 评分 | 说明 |
|------|------|------|
| 流式输出支持 | ⭐⭐⭐⭐⭐ | 直接操作AST，增量更新性能极佳 |
| Word导出 | ⭐⭐⭐⭐ | 有官方`tiptap-exporters`插件 |
| TypeScript支持 | ⭐⭐⭐⭐⭐ | 原生TypeScript，类型完善 |
| 包体积 | ⭐⭐⭐⭐ | 约200KB（按需加载） |
| 学习曲线 | ⭐⭐⭐⭐ | API简洁，文档完善 |
| 社区活跃度 | ⭐⭐⭐⭐⭐ | 活跃，有商业支持 |

**依赖配置**
```json
{
  "@tiptap/react": "^2.10.0",
  "@tiptap/starter-kit": "^2.10.0",
  "@tiptap/extension-typography": "^2.10.0",
  "@tiptap/extension-placeholder": "^2.10.0",
  "html-to-docx": "^1.8.0"
}
```

**流式输出实现**
```tsx
// 使用Tiptap的transaction实现增量更新
editor.commands.insertContent(incrementalContent)
```

**Word导出**
```tsx
import htmlToDocx from 'html-to-docx'
const docx = await htmlToDocx(editor.getHTML(), options)
```

---

### 方案B：Quill + html-docx-js

**简介**
Quill是轻量级富文本编辑器，API简洁。

**优势**
| 特性 | 评分 | 说明 |
|------|------|------|
| 流式输出支持 | ⭐⭐⭐ | Delta格式支持增量更新 |
| Word导出 | ⭐⭐⭐ | 需要配合html-docx-js |
| TypeScript支持 | ⭐⭐⭐ | 有社区类型定义 |
| 包体积 | ⭐⭐⭐⭐⭐ | 仅约50KB |
| 学习曲线 | ⭐⭐⭐⭐⭐ | API非常简洁 |
| 社区活跃度 | ⭐⭐⭐ | 维护中，但不如Tiptap活跃 |

**依赖配置**
```json
{
  "quill": "^2.0.2",
  "html-docx-js": "^0.3.1"
}
```

---

### 方案C：Slate.js

**简介**
Slate是高度可定制的富文本编辑器框架。

**优势**
| 特性 | 评分 | 说明 |
|------|------|------|
| 流式输出支持 | ⭐⭐⭐⭐⭐ | 完全自定义，灵活度最高 |
| Word导出 | ⭐⭐⭐ | 需要自定义序列化 |
| TypeScript支持 | ⭐⭐⭐⭐ | TypeScript优先 |
| 包体积 | ⭐⭐⭐ | 按需定制，核心约100KB |
| 学习曲线 | ⭐⭐ | 学习曲线陡峭 |
| 社区活跃度 | ⭐⭐⭐ | 维护中 |

---

## 推荐方案：Tiptap

### 选择理由

1. **流式输出优化** - Tiptap基于ProseMirror，底层操作文档AST，比直接操作DOM的编辑器性能更好
2. **现代架构** - React 19/TypeScript原生支持
3. **Word导出成熟** - 已有`html-to-docx`等成熟方案
4. **扩展性强** - 丰富的官方和社区扩展

### 实施计划

**Phase 1: 基础编辑器集成** (1-2天)
- [ ] 安装Tiptap核心依赖
- [ ] 创建基础编辑器组件
- [ ] 实现基本格式化功能

**Phase 2: 流式输出支持** (1天)
- [ ] 集成EnhancedStreamingOutput组件
- [ ] 实现增量内容追加
- [ ] 优化打字机效果

**Phase 3: Word导出功能** (1天)
- [ ] 集成html-to-docx
- [ ] 实现导出逻辑
- [ ] 测试各种格式内容导出

### 预计包体积增量
- Tiptap核心: ~200KB
- Word导出: ~50KB
- 总增量: ~250KB

---

## 结论

对于投资方案报告模块的需求，**Tiptap** 是最佳选择：
- ✅ 出色的流式输出性能
- ✅ 成熟的Word导出方案
- ✅ 现代化技术栈
- ✅ 良好的TypeScript支持

建议切换到Tiptap编辑器以获得更好的用户体验。
