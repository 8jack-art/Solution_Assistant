# 章节配置不生效问题修复计划

## 问题描述
章节配置modal里的设置不生效，导出Word时没有封面页信息。

## 用户需求
- ✅ 封面页：主标题、副标题、建设单位、日期
- ❌ 目录页：不需要

## 问题分析

### 根本原因
导出Word流程中，`sections`（章节配置）没有从前端传递到后端，导致封面页没有生成。

### 问题链路
```
SectionConfigPanel → reportStore.sections → exportToWord() 
    ↓ 缺少sections参数
reportApi.exportHtml() → export-html接口 → generateWordFromHtml()
    ↓
结果：没有生成封面页
```

## 修复方案

### 实施步骤

#### Step 1: 修改前端 reportApi.ts
在 `exportHtml()` 方法中添加 `sections` 参数：
```typescript
async exportHtml(options: {
  title?: string
  htmlContent: string
  styleConfig?: ReportStyleConfig
  resources?: ResourceMap
  sections?: ReportSections  // 新增
})
```

#### Step 2: 修改前端 reportStore.ts
在 `exportToWord()` 方法中传递 `store.sections` 到API：
```typescript
exportToWord: async () => {
  // ...获取 sections
  await reportApi.exportHtml({
    title: reportTitle,
    htmlContent,
    styleConfig: completeConfig,
    resources,
    sections: get().sections  // 新增
  })
}
```

#### Step 3: 修改后端 reportController.ts
在 `exportHtml()` 接口中接收 `sections` 参数：
```typescript
const { 
  title, 
  htmlContent, 
  styleConfig,
  resources,
  sections  // 新增
} = req.body
```

#### Step 4: 修改后端 reportService.ts
在 `generateWordFromHtml()` 方法中处理封面页：
1. 接收 `sections` 参数
2. 根据 sections.cover 生成封面页HTML
3. 将封面页插入到主内容前

### 封面页HTML结构
```html
<div class="cover-page" style="page-break-after: always;">
  <h1 class="cover-title">${sections.cover.title}</h1>
  ${sections.cover.subtitle ? `<p class="cover-subtitle">${sections.cover.subtitle}</p>` : ''}
  <div class="cover-info">
    <p>建设单位：${sections.cover.companyName || ''}</p>
    <p>日期：${sections.cover.date}</p>
  </div>
</div>
```

### CSS样式
```css
.cover-page {
  text-align: center;
  padding: 150px 50px;
  min-height: 600px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.cover-title {
  font-size: 28pt;
  font-weight: bold;
  margin-bottom: 20px;
}
.cover-subtitle {
  font-size: 18pt;
  color: #666;
  margin-bottom: 80px;
}
.cover-info {
  font-size: 14pt;
  line-height: 2;
}
```

## 验收标准
1. 章节配置modal中启用封面后，导出Word包含封面页
2. 封面页显示用户配置的标题、副标题、建设单位、日期
