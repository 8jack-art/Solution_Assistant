# 前后端服务重启指南

## 当前状态
检测到以下服务正在运行（属于用户 `hhm`）：
- 后端服务：`node src/server.ts` (PID: 257319)
- 前端服务：`vite` (PID: 257272)
- 并发管理器：`concurrently` (PID: 257173)
- 监视器：`tsx watch` (PID: 257264)

## 重启步骤

### 方法一：手动停止并重启（推荐）

#### 1. 停止当前服务
在运行服务的终端（pts/4）中按 `Ctrl + C` 停止服务。

#### 2. 重新启动服务
在项目根目录下执行：
```bash
npm run dev
```

或者分别启动：
```bash
# 终端 1：启动后端
npm run dev:server

# 终端 2：启动前端
npm run dev:client
```

### 方法二：使用 kill 命令（需要 sudo 权限）

如果无法访问运行服务的终端，可以使用以下命令：

```bash
# 停止所有相关进程
sudo kill 257173 257264 257272 257319

# 确认进程已停止
ps aux | grep -E "(node|vite)" | grep -v grep

# 重新启动服务
npm run dev
```

### 方法三：使用 pkill 命令

```bash
# 停止所有 node 和 vite 进程
sudo pkill -f "node src/server.ts"
sudo pkill -f "vite"
sudo pkill -f "concurrently"
sudo pkill -f "tsx watch"

# 重新启动服务
npm run dev
```

## 验证服务启动

### 1. 检查后端服务
```bash
curl http://localhost:3001/api/health
```

预期输出：`{"status":"ok"}` 或类似的健康检查响应。

### 2. 检查前端服务
在浏览器中访问：`http://localhost:5173`

预期结果：能够正常访问项目首页。

### 3. 检查进程状态
```bash
ps aux | grep -E "(node|vite)" | grep -v grep
```

预期结果：应该看到新的 node 和 vite 进程在运行。

## 常见问题

### 问题 1：端口被占用
如果启动时提示端口被占用：
```bash
# 查找占用端口的进程
lsof -i :3001  # 后端端口
lsof -i :5173  # 前端端口

# 停止占用端口的进程
kill -9 <PID>
```

### 问题 2：依赖问题
如果启动时出现依赖错误：
```bash
# 重新安装依赖
npm install

# 清理缓存
npm cache clean --force
```

### 问题 3：数据库连接问题
如果后端无法连接数据库：
```bash
# 检查数据库服务状态
sudo systemctl status postgresql

# 启动数据库服务
sudo systemctl start postgresql
```

## 重启后的测试

重启服务后，建议进行以下测试：

1. **财务指标数据保存测试**
   - 打开"收入成本模型"页面
   - 点击"财务计算指标表"按钮
   - 等待财务指标计算完成
   - 刷新页面，确认数据保持

2. **报告生成测试**
   - 打开"报告生成"页面
   - 选择项目并生成报告
   - 检查 `{{DATA:financial_indicators}}` 部分的 `investmentReturns` 数据
   - 确认所有字段值都不为 0

3. **控制台日志检查**
   - 打开浏览器开发者工具（F12）
   - 切换到 Console 标签页
   - 检查是否有错误信息

## 注意事项

1. **数据备份**：在重启服务前，建议备份重要数据
2. **测试环境**：建议先在测试环境中验证修复
3. **监控日志**：重启后注意查看控制台日志，确保没有错误
4. **逐步验证**：按照测试计划逐步验证功能是否正常

## 相关文档

- [investmentReturns 数据获取错误修复方案](./investmentReturns数据获取错误修复方案.md)
- [investmentReturns 数据修复测试计划](./investmentReturns数据修复测试计划.md)
