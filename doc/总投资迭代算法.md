# 迭代算法1 需求逻辑文档

文档版本：V1.0

适用场景：项目投资测算子项拆分与总额收敛计算

核心目标：明确项目投资测算中子项拆分与总额收敛的迭代逻辑，供算法开发参考，实现通过迭代调整使AI拆分的子项投资总额收敛至目标总投资偏差率≤1.5%，最终输出符合要求的投资表

## 一、算法核心定义

- 目标总投资：$m_1$（从项目基本信息中提取的固定基准值）

- 第n次迭代项目总资金（G项目总资金）：$z_n$（投资表按预设法则核算得出，n≥1，初始n=1）

- 迭代次数：n（记录每次调整的循环次数，初始值为1）

- 调整对象：「A 第一部分 工程费用」项下所有子项（以下简称“目标子项”）

- 偏差率：$\text{偏差率} = \frac{|z_n - m_1|}{m_1} \times 100\%$（工程投资测算通用相对偏差标准）

## 二、核心约束规则

### 1. 迭代终止规则（满足任一即可）

- 核心条件：偏差率≤1.5%

- 兜底条件：迭代次数n≥50（避免无限循环，触发人工干预）

### 2. “高减低加”调整规则

- 调整触发：对比$m_1$与第n次迭代总额$z_n$

- 下调规则：若$z_n > m_1$（总额偏高），下调目标子项投资额

- 上调规则：若$z_n < m_1$（总额偏低），上调目标子项投资额

- 调整幅度：单次调整所有子项投资额的0.5%~1%（优先取中间值0.75%，特殊子项可微调）


- 调整限制：单个子项累计调整幅度不超过其初始投资额的20%（避免子项投资额偏离合理范围）

### 3. AI子项拆分约束规则

- 类别匹配：拆分的子项需与项目类型（如建筑工程、市政工程等）匹配，符合行业投资测算子项分类标准

- 占比合理：单个子项投资额占「A 第一部分 工程费用」总额的比例不低于1%（避免过小子项，减少无效调整）


### 4. 投资表核算规则

- 核算逻辑：投资表需按“子项投资额汇总→加计各项规费→加计税金→得出项目总资金$z_n$”的流程核算

- 固定参数：规费、税金的计取比例按项目所属行业现行标准执行，迭代过程中不调整该类参数

## 三、完整执行步骤

1. 步骤1：基础数据准备与首次拆分
- 从项目基本信息系统提取目标总投资$m_1$，以及项目类型、行业归属、规费税率等基础参数；
- 启动AI子项拆分模块，基于项目信息按“AI子项拆分约束规则”完成第1次子项拆分，生成子项清单（含名称、编码、初始投资额等）；
- 将子项清单录入投资表，按“投资表核算规则”核算得出第1次迭代总额$z_1$，记录迭代次数n=1。

2. 步骤2：偏差率计算与迭代判定
- 按偏差率公式计算$\text{偏差率} = \frac{|z_n - m_1|}{m_1} \times 100\%$；
- 判定是否终止迭代：
  1. 若偏差率≤1.5%：终止迭代，执行步骤5；
  2. 若n≥50：终止迭代，触发人工干预流程，执行步骤6；
  3. 若上述条件均不满足：进入步骤3进行调整。

3. 步骤3：子项投资额调整
- 根据$z_n$与$m_1$的大小关系，确定调整方向（上调/下调）；
- 选取所有子项，确定单次调整幅度（0.5%~1%）；


4. 步骤4：新一轮迭代核算
- 将调整后的子项清单重新录入投资表，按核算规则得出第n+1次迭代总额$z_{n+1}$；
- 迭代次数更新为n=n+1，返回步骤2重复执行。

5. 步骤5：正常终止输出
- 输出最终版投资表（含所有子项最终投资额、各项规费、税金、项目总资金$z_n$）；
- 输出迭代报告：含迭代总次数、初始$z_1$、最终$z_n$、偏差率、关键子项调整记录。

