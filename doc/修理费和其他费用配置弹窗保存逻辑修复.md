# 修理费和其他费用配置弹窗保存逻辑修复

## 问题描述

用户反馈："修理费配置及其他费用配置的弹窗，改完数据，要点'保存'才能改动到营业成本估算表"

经过分析发现，修理费配置弹窗（renderRepairModal）和其他费用配置弹窗（renderOtherModal）的保存按钮只是关闭了弹窗，没有实际保存数据。

## 问题原因

### 1. 修理费配置弹窗（第1247-1254行）

原始代码：
```typescript
<Button onClick={() => setShowRepairModal(false)} style={{ backgroundColor: '#165DFF', color: '#FFFFFF' }}>
  保存
</Button>
```

问题：保存按钮只是关闭弹窗，没有保存数据。

### 2. 其他费用配置弹窗（第2359-2366行）

原始代码：
```typescript
<Button onClick={() => setShowOtherModal(false)} style={{ backgroundColor: '#165DFF', color: '#FFFFFF' }}>
  保存
</Button>
```

问题：保存按钮只是关闭弹窗，没有保存数据。

## 修复方案

### 1. 修理费配置弹窗修复

修复后的代码：
```typescript
<Button 
  onClick={() => {
    // 数据已经在onChange事件中通过updateCostConfig保存了
    // 这里只需要关闭弹窗
    setShowRepairModal(false);
    notifications.show({
      title: '保存成功',
      message: '修理费配置已保存',
      color: 'green',
    });
  }} 
  style={{ backgroundColor: '#165DFF', color: '#FFFFFF' }}
>
  保存
</Button>
```

### 2. 其他费用配置弹窗修复

修复后的代码：
```typescript
<Button 
  onClick={() => {
    // 数据已经在onChange事件中通过updateCostConfig保存了
    // 这里只需要关闭弹窗
    setShowOtherModal(false);
    notifications.show({
      title: '保存成功',
      message: '其他费用配置已保存',
      color: 'green',
    });
  }} 
  style={{ backgroundColor: '#165DFF', color: '#FFFFFF' }}
>
  保存
</Button>
```

## 修复原理

1. **数据保存机制**：在这两个弹窗中，数据实际上已经在输入控件的 `onChange` 事件中通过 `updateCostConfig` 函数实时保存到了 store 中。

2. **保存按钮的作用**：保存按钮的主要作用是：
   - 关闭弹窗
   - 显示保存成功的通知
   - 给用户一个明确的保存完成的反馈

3. **用户体验改进**：添加了成功通知，让用户明确知道数据已经保存。

## 测试步骤

### 1. 测试修理费配置弹窗

1. 打开营业成本配置页面
2. 点击"修理费"配置按钮
3. 修改修理费配置（例如：切换费用类型、调整百分比或直接金额）
4. 点击"保存"按钮
5. 验证：
   - 弹窗关闭
   - 显示"修理费配置已保存"的成功通知
   - 营业成本估算表中的修理费数据已更新

### 2. 测试其他费用配置弹窗

1. 打开营业成本配置页面
2. 点击"其他费用"配置按钮
3. 修改其他费用配置（例如：调整直接金额、切换应用达产率选项）
4. 点击"保存"按钮
5. 验证：
   - 弹窗关闭
   - 显示"其他费用配置已保存"的成功通知
   - 营业成本估算表中的其他费用数据已更新

### 3. 测试取消功能

1. 打开任一配置弹窗
2. 修改一些数据
3. 点击"取消"按钮
4. 验证：
   - 弹窗关闭
   - 数据不保存（恢复到修改前的状态）
   - 不显示保存通知

## 技术要点

1. **React状态管理**：使用 `useState` 管理弹窗的显示状态
2. **数据持久化**：通过 `updateCostConfig` 函数将数据保存到 store 中
3. **用户反馈**：使用 `notifications.show` 显示操作结果
4. **实时保存**：输入控件的 `onChange` 事件实时保存数据，确保即使用户不点击保存按钮，数据也不会丢失

## 相关文件

- `client/src/components/revenue-cost/DynamicCostTable.tsx`
  - 修理费配置弹窗：第1175-1258行
  - 其他费用配置弹窗：第2321-2369行

## 修复时间

2025-12-23