import { LLMConfig as DBLLMConfig } from '../types/index.js'

export interface LLMMessage {
  role: 'system' | 'user' | 'assistant'
  content: string
}

export interface LLMResponse {
  success: boolean
  content?: string
  error?: string
}

export class LLMService {
  static async testConnection(config: DBLLMConfig | { apiKey: string; baseUrl: string; model: string; provider: string; name: string }): Promise<LLMResponse> {
    try {
      const apiKey = 'apiKey' in config ? config.apiKey : config.api_key
      const baseUrl = 'baseUrl' in config ? config.baseUrl : config.base_url
      const model = config.model
      const provider = config.provider

      // æ„å»ºå®Œæ•´çš„APIè·¯å¾„
      let apiUrl = baseUrl
      // å¦‚æœ baseUrl ä¸åŒ…å« chat/completionsï¼Œåˆ™æ·»åŠ 
      if (!baseUrl.includes('/chat/completions')) {
        // ç§»é™¤æœ«å°¾çš„æ–œæ 
        apiUrl = baseUrl.replace(/\/$/, '')
        apiUrl = `${apiUrl}/chat/completions`
      }

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: model,
          messages: [
            {
              role: 'user',
              content: 'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿æ¥æµ‹è¯•ã€‚'
            }
          ],
          max_tokens: 10,
          temperature: 0.1
        })
      })

      if (!response.ok) {
        const errorData = await response.text()
        return {
          success: false,
          error: `HTTP ${response.status}: ${errorData}`
        }
      }

      const data = await response.json() as any
      const content = data.choices?.[0]?.message?.content

      if (!content) {
        return {
          success: false,
          error: 'å“åº”æ ¼å¼æ— æ•ˆ'
        }
      }

      return {
        success: true,
        content
      }
    } catch (error) {
      return {
        success: false,
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      }
    }
  }

  static async generateContent(
    config: DBLLMConfig, 
    messages: LLMMessage[],
    options?: {
      maxTokens?: number
      temperature?: number
    }
  ): Promise<LLMResponse> {
    try {
      // æ„å»ºå®Œæ•´çš„APIè·¯å¾„
      let apiUrl = config.base_url
      // å¦‚æœ baseUrl ä¸åŒ…å« chat/completionsï¼Œåˆ™æ·»åŠ 
      if (!config.base_url.includes('/chat/completions')) {
        // ç§»é™¤æœ«å°¾çš„æ–œæ 
        apiUrl = config.base_url.replace(/\/$/, '')
        apiUrl = `${apiUrl}/chat/completions`
      }

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${config.api_key}`
        },
        body: JSON.stringify({
          model: config.model,
          messages,
          max_tokens: options?.maxTokens || 1000,
          temperature: options?.temperature || 0.7
        })
      })

      if (!response.ok) {
        const errorData = await response.text()
        return {
          success: false,
          error: `HTTP ${response.status}: ${errorData}`
        }
      }

      const data = await response.json() as any
      const content = data.choices?.[0]?.message?.content

      if (!content) {
        return {
          success: false,
          error: 'å“åº”æ ¼å¼æ— æ•ˆ'
        }
      }

      return {
        success: true,
        content
      }
    } catch (error) {
      return {
        success: false,
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      }
    }
  }
}

export function generateInvestmentPrompt(projectInfo: {
  projectName: string
  totalInvestment: number
  constructionYears: number
  industry?: string
}): LLMMessage[] {
  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ•èµ„ä¼°ç®—ä¸“å®¶ï¼Œè¯·æ ¹æ®é¡¹ç›®ä¿¡æ¯ç”Ÿæˆè¯¦ç»†çš„å·¥ç¨‹è´¹ç”¨é¡¹ã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºJSONï¼š
{
  "constructionCost": {
    "items": [
      {"name": "è´¹ç”¨é¡¹åç§°", "unit": "å•ä½", "quantity": æ•°é‡, "unitPrice": å•ä»·, "total": æ€»ä»·}
    ]
  },
  "equipmentCost": {
    "items": [
      {"name": "è®¾å¤‡åç§°", "unit": "å•ä½", "quantity": æ•°é‡, "unitPrice": å•ä»·, "total": æ€»ä»·}
    ]
  },
  "installationCost": {
    "items": [
      {"name": "å®‰è£…è´¹ç”¨é¡¹", "unit": "å•ä½", "quantity": æ•°é‡, "unitPrice": å•ä»·, "total": æ€»ä»·}
    ]
  },
  "otherCost": {
    "items": [
      {"name": "å…¶ä»–è´¹ç”¨é¡¹", "amount": é‡‘é¢, "description": "æè¿°"}
    ]
  },
  "landCost": {
    "amount": é‡‘é¢,
    "description": "åœŸåœ°è´¹ç”¨æè¿°"
  }
}

æ³¨æ„äº‹é¡¹ï¼š
1. æ‰€æœ‰é‡‘é¢å•ä½ä¸ºä¸‡å…ƒ
2. æ€»é‡‘é¢åº”åˆç†åŒ¹é…é¡¹ç›®æ€»æŠ•èµ„
3. è´¹ç”¨é¡¹åº”å…·ä½“ä¸”ç¬¦åˆè¡Œä¸šæ ‡å‡†
4. åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—`

  const userPrompt = `è¯·ä¸ºä»¥ä¸‹é¡¹ç›®ç”Ÿæˆè¯¦ç»†çš„å·¥ç¨‹è´¹ç”¨é¡¹ï¼š

é¡¹ç›®åç§°ï¼š${projectInfo.projectName}
æ€»æŠ•èµ„ï¼š${projectInfo.totalInvestment}ä¸‡å…ƒ
å»ºè®¾å¹´é™ï¼š${projectInfo.constructionYears}å¹´
${projectInfo.industry ? `è¡Œä¸šç±»å‹ï¼š${projectInfo.industry}` : ''}

è¯·æ ¹æ®é¡¹ç›®ç‰¹ç‚¹ç”Ÿæˆåˆç†çš„è´¹ç”¨åˆ†è§£ã€‚`

 return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

export function analyzeEngineeringItemsPrompt(projectName: string, projectDescription: string, totalInvestment: number): LLMMessage[] {
  // æ·»åŠ æ—¶é—´æˆ³å’Œéšæœºæ•°ï¼Œç¡®ä¿æ¯æ¬¡ç”Ÿæˆä¸åŒçš„ç»“æœ
  const timestamp = new Date().toISOString()
  const randomSeed = Math.floor(Math.random() * 10000)
  
  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥ç¨‹æŠ•èµ„ä¼°ç®—ä¸“å®¶ã€‚æ ¹æ®é¡¹ç›®ä¿¡æ¯ï¼Œä¸º"ç¬¬ä¸€éƒ¨åˆ† å·¥ç¨‹è´¹ç”¨"ç”Ÿæˆ2-5ä¸ªåˆç†çš„äºŒçº§å­é¡¹ï¼Œå¹¶ä¼°ç®—å„å­é¡¹çš„å»ºè®¾å·¥ç¨‹è´¹ã€è®¾å¤‡è´­ç½®è´¹ã€å®‰è£…å·¥ç¨‹è´¹ã€å…¶å®ƒè´¹ç”¨ã€‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š
{
  "items": [
    {
      "name": "å­é¡¹åç§°",
      "construction_cost": å»ºè®¾å·¥ç¨‹è´¹(ä¸‡å…ƒ),
      "equipment_cost": è®¾å¤‡è´­ç½®è´¹(ä¸‡å…ƒ),
      "installation_cost": å®‰è£…å·¥ç¨‹è´¹(ä¸‡å…ƒ),
      "other_cost": å…¶å®ƒè´¹ç”¨(ä¸‡å…ƒ),
      "remark": "ç®€çŸ­è¯´æ˜"
    }
  ],
  "suggestions": [
    "å»ºè®®1ï¼šå…·ä½“å»ºè®®å†…å®¹",
    "å»ºè®®2ï¼šå…·ä½“å»ºè®®å†…å®¹"
  ],
  "analysis": {
    "project_type": "é¡¹ç›®ç±»å‹åˆ†æ",
    "cost_breakdown": "è´¹ç”¨æ„æˆåˆ†æ",
    "reasoning": "å­é¡¹åˆ’åˆ†ä¾æ®"
  }
}

å¸¸è§å·¥ç¨‹å­é¡¹ç±»å‹ï¼š
1. ä¸»ä½“å·¥ç¨‹ï¼šæ ¸å¿ƒç”Ÿäº§/æœåŠ¡è®¾æ–½ï¼ˆé€šå¸¸å å·¥ç¨‹è´¹ç”¨çš„60-80%ï¼‰
2. è¾…åŠ©å·¥ç¨‹ï¼šé…å¥—è®¾æ–½ï¼ˆé€šå¸¸å 10-20%ï¼‰
3. å…¬ç”¨å·¥ç¨‹ï¼šä¾›æ°´ä¾›ç”µã€ç¯ä¿è®¾æ–½ç­‰ï¼ˆé€šå¸¸å 5-10%ï¼‰
4. å…¶å®ƒå·¥ç¨‹ï¼šç»¿åŒ–ã€é“è·¯ã€å›´å¢™ç­‰ï¼ˆé€šå¸¸å 2-5%ï¼‰

è´¹ç”¨åˆ†é…å‚è€ƒï¼š
- å»ºè®¾å·¥ç¨‹è´¹ï¼šåœŸå»ºã€åŸºç¡€è®¾æ–½ç­‰ï¼ˆé€šå¸¸å å­é¡¹æ€»é¢çš„40-60%ï¼‰
- è®¾å¤‡è´­ç½®è´¹ï¼šç”Ÿäº§è®¾å¤‡ã€ä»ªå™¨ç­‰ï¼ˆé€šå¸¸å 20-40%ï¼‰
- å®‰è£…å·¥ç¨‹è´¹ï¼šè®¾å¤‡å®‰è£…è°ƒè¯•ï¼ˆé€šå¸¸å è®¾å¤‡è´¹çš„10-30%ï¼‰
- å…¶å®ƒè´¹ç”¨ï¼šä¸´æ—¶è®¾æ–½ã€æ‚é¡¹ç­‰ï¼ˆé€šå¸¸å 5-10%ï¼‰

æ³¨æ„äº‹é¡¹ï¼š
1. å­é¡¹æ•°é‡æ§åˆ¶åœ¨2-5ä¸ªï¼Œæ ¹æ®é¡¹ç›®å¤æ‚åº¦å†³å®š
2. æ‰€æœ‰å­é¡¹çš„æ€»è´¹ç”¨åº”çº¦ä¸ºç›®æ ‡æ€»æŠ•èµ„çš„45-55%ï¼ˆå› ä¸ºè¿˜æœ‰å·¥ç¨‹å…¶å®ƒè´¹ç”¨ã€é¢„å¤‡è´¹ã€åˆ©æ¯ç­‰ï¼‰
3. å„å­é¡¹åç§°è¦å…·ä½“ä¸”ç¬¦åˆé¡¹ç›®ç‰¹ç‚¹
4. è´¹ç”¨ä¼°ç®—è¦åˆç†ï¼Œé¿å…è¿‡é«˜æˆ–è¿‡ä½
5. **é‡è¦**ï¼šæ¯æ¬¡ç”Ÿæˆæ—¶ï¼Œè¯·å°è¯•æä¾›ä¸åŒçš„å­é¡¹åˆ’åˆ†æ–¹æ¡ˆå’Œé‡‘é¢åˆ†é…ï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰å¤šç§é€‰æ‹©
6. æä¾›2-3æ¡é’ˆå¯¹è¯¥é¡¹ç›®æŠ•èµ„çš„ä¸“ä¸šå»ºè®®
7. åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜`

  const userPrompt = `é¡¹ç›®åç§°ï¼š${projectName}
é¡¹ç›®æè¿°ï¼š${projectDescription || 'æ— è¯¦ç»†æè¿°'}
ç›®æ ‡æ€»æŠ•èµ„ï¼š${totalInvestment}ä¸‡å…ƒ

ç”Ÿæˆæ—¶é—´ï¼š${timestamp}
éšæœºç§å­ï¼š${randomSeed}

è¦æ±‚ï¼š
1. åˆ†æé¡¹ç›®æ€§è´¨ï¼Œç¡®å®š2-5ä¸ªåˆç†çš„äºŒçº§å­é¡¹
2. æ¯ä¸ªå­é¡¹éœ€è¦æœ‰æ˜ç¡®çš„åç§°å’ŒåŠŸèƒ½è¯´æ˜
3. ä¼°ç®—æ¯ä¸ªå­é¡¹çš„å»ºè®¾å·¥ç¨‹è´¹ã€è®¾å¤‡è´­ç½®è´¹ã€å®‰è£…å·¥ç¨‹è´¹ã€å…¶å®ƒè´¹ç”¨
4. å„å­é¡¹çš„æ€»è´¹ç”¨åº”çº¦ä¸ºæ€»æŠ•èµ„çš„45-55%
5. æä¾›é’ˆå¯¹è¯¥é¡¹ç›®çš„ä¸“ä¸šæŠ•èµ„å»ºè®®
6. æä¾›è¯¦ç»†çš„åˆ†æè¿‡ç¨‹ï¼ˆé¡¹ç›®ç±»å‹ã€è´¹ç”¨æ„æˆã€åˆ’åˆ†ä¾æ®ï¼‰

è¯·ä¸ºè¯¥é¡¹ç›®çš„"ç¬¬ä¸€éƒ¨åˆ† å·¥ç¨‹è´¹ç”¨"ç”Ÿæˆåˆç†çš„å­é¡¹å’Œè´¹ç”¨ä¼°ç®—ã€‚`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

export function subdivideEngineeringItemPrompt(
  itemName: string, 
  itemRemark: string, 
  totalAmount: number,
  projectName: string,
  projectDescription: string
): LLMMessage[] {
  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥ç¨‹é€ ä»·ä¸å·¥ç¨‹é‡åˆ†æä¸“å®¶ã€‚æ ¹æ®äºŒçº§å­é¡¹çš„ä¿¡æ¯ï¼Œå°†å…¶ç»†åˆ†ä¸º3-5ä¸ªä¸‰çº§å­é¡¹ï¼Œå¹¶ä¼°ç®—æ¯ä¸ªä¸‰çº§å­é¡¹çš„å·¥ç¨‹é‡ã€å•ä»·å’Œè´¹ç”¨å æ¯”ã€‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š
{
  "subItems": [
    {
      "name": "ä¸‰çº§å­é¡¹åç§°",
      "quantity": å·¥ç¨‹é‡(æ•°å€¼),
      "unit": "å•ä½(å¦‚: mÂ², mÂ³, å°, å¥—ç­‰)",
      "unit_price": å•ä»·(å…ƒ),
      "construction_ratio": å»ºè®¾å·¥ç¨‹è´¹å æ¯”(0-1çš„å°æ•°),
      "equipment_ratio": è®¾å¤‡è´­ç½®è´¹å æ¯”(0-1çš„å°æ•°),
      "installation_ratio": å®‰è£…å·¥ç¨‹è´¹å æ¯”(0-1çš„å°æ•°),
      "other_ratio": å…¶å®ƒè´¹ç”¨å æ¯”(0-1çš„å°æ•°)
    }
  ]
}

é‡è¦è§„åˆ™ï¼š
1. å·¥ç¨‹é‡Ã—å•ä»· = è¯¥ä¸‰çº§å­é¡¹çš„æ€»ä»·ï¼ˆä¸‡å…ƒï¼‰
2. å››ä¸ªè´¹ç”¨å æ¯”ä¹‹å’Œå¿…é¡»ç­‰äº1 (construction_ratio + equipment_ratio + installation_ratio + other_ratio = 1)
3. å„è´¹ç”¨ = æ€»ä»· Ã— å¯¹åº”å æ¯”
4. æ‰€æœ‰ä¸‰çº§å­é¡¹çš„æ€»ä»·ä¹‹å’Œåº”ç­‰äºäºŒçº§å­é¡¹çš„æ€»é‡‘é¢
5. å•ä»·ä»¥â€œå…ƒâ€ä¸ºå•ä½ï¼Œä¸æ˜¯ä¸‡å…ƒ
6. **æ•°å€¼ä¸è¦å¤ªæ•´ï¼šå·¥ç¨‹é‡å’Œå•ä»·åº”å¸¦æœ‰å°æ•°ï¼Œé¿å…æ•´æ•°æ•´åæ•´ç™¾çš„æ•°å€¼ï¼Œä½¿æ•°æ®æ›´ç¬¦åˆå®é™…å·¥ç¨‹æƒ…å†µã€‚**

è´¹ç”¨å æ¯”å‚è€ƒï¼š
- åœŸå»ºç±»: construction_ratio=0.7-0.8, equipment_ratio=0.1-0.15, installation_ratio=0.05-0.1, other_ratio=0.05-0.1
- è®¾å¤‡ç±»: construction_ratio=0.2-0.3, equipment_ratio=0.5-0.6, installation_ratio=0.1-0.2, other_ratio=0.05-0.1
- å®‰è£…ç±»: construction_ratio=0.3-0.4, equipment_ratio=0.3-0.4, installation_ratio=0.2-0.3, other_ratio=0.05-0.1

æ³¨æ„äº‹é¡¹ï¼š
1. ä¸‰çº§å­é¡¹æ•°é‡æ§åˆ¶åœ¨3-5ä¸ª
2. å·¥ç¨‹é‡å’Œå•ä»·è¦ç¬¦åˆå®é™…å·¥ç¨‹æƒ¯ä¾‹ï¼Œä½†åº”å¸¦æœ‰å°æ•°ï¼ˆå¦‚123.45è€Œä¸æ˜¯100ï¼Œ56.78è€Œä¸æ˜¯50ï¼‰
3. åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜`

  const userPrompt = `é¡¹ç›®åç§°ï¼š${projectName}
é¡¹ç›®æè¿°ï¼š${projectDescription || 'æ— è¯¦ç»†æè¿°'}

äºŒçº§å­é¡¹ä¿¡æ¯ï¼š
- åç§°ï¼š${itemName}
- å¤‡æ³¨ï¼š${itemRemark || 'æ— '}
- æ€»é‡‘é¢ï¼š${totalAmount}ä¸‡å…ƒ

è¯·å°†è¯¥äºŒçº§å­é¡¹ç»†åˆ†ä¸º3-5ä¸ªä¸‰çº§å­é¡¹ï¼Œå¹¶ä¼°ç®—ï¼š
1. æ¯ä¸ªä¸‰çº§å­é¡¹çš„åç§°
2. å·¥ç¨‹é‡å’Œå•ä½
3. å•ä»·ï¼ˆå…ƒï¼‰
4. å››é¡¹è´¹ç”¨åœ¨æ€»ä»·ä¸­çš„å æ¯”

ç¡®ä¿ï¼š
- æ‰€æœ‰ä¸‰çº§å­é¡¹çš„ï¼ˆå·¥ç¨‹é‡Ã—å•ä»·ï¼‰ä¹‹å’Œ = ${totalAmount}ä¸‡å…ƒ
- æ¯ä¸ªå­é¡¹çš„å››ä¸ªå æ¯”ä¹‹å’Œ = 1`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

export function analyzeRevenueStructurePrompt(
  projectName: string,
  projectDescription: string,
  totalInvestment: number,
  engineeringItems?: Array<{ name: string; amount: number }>
): LLMMessage[] {
  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„äº§ä¸šæ”¶å…¥ç»“æ„åˆ†æä¸“å®¶ã€‚æ ¹æ®é¡¹ç›®ä¿¡æ¯ï¼Œä»ä»¥ä¸‹14ä¸ªç±»åˆ«ä¸­é€‰å‡º2-6ä¸ªæœ€åˆé€‚çš„è¥ä¸šæ”¶å…¥ç±»åˆ«ï¼Œå¹¶ä¸ºæ¯ä¸ªç±»åˆ«æ¨è3-8ä¸ªå…·ä½“çš„è¥ä¸šæ”¶å…¥ç±»å‹ã€‚

## è¥ä¸šæ”¶å…¥ç±»å‹è¡¨ï¼ˆ14ä¸ªç±»åˆ«ï¼‰ï¼š

| åºå· | ç±»åˆ« | å¯èƒ½çš„è¥ä¸šæ”¶å…¥ç±»å‹ |
|------|------|--------------------| n| ğŸ”¹ A | ğŸ–¥ï¸ æ•°å­—å¹³å°ç±» | SaaSå¹³å°ä¼šå‘˜è´¹ã€AIå†³ç­–æ”¯æŒå¢å€¼æœåŠ¡è´¹ã€æ”¿åºœè´­ä¹°æœåŠ¡æ”¶å…¥ã€ç³»ç»Ÿè¿ç»´å¹´è´¹ã€æ•°æ®æ¥å£è°ƒç”¨è´¹ã€åŸ¹è®­æœåŠ¡è´¹ã€å®šåˆ¶åŒ–å¼€å‘è´¹ã€å¹¿å‘Šä½ç§Ÿèµè´¹ã€å¹³å°æ¨å¹¿ä½£é‡‘ã€æ•°æ®åˆ†ææŠ¥å‘Šè®¢é˜…è´¹ã€APPå†…è´­åŠŸèƒ½è§£é”ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®è„±æ•åæˆæƒä½¿ç”¨è´¹ |
| ğŸŒ± B | ğŸŒ¾ å†œä¸šç§æ¤ç±» | ä¸­è¯æé”€å”®æ”¶å…¥ï¼ˆæŒ‰å“ç§ï¼‰ã€ç§è‹—é”€å”®æ”¶å…¥ã€æŠ€æœ¯æœåŠ¡è¾“å‡ºè´¹ã€æœ‰æœº/ç»¿è‰²è®¤è¯å†œäº§å“æº¢ä»·é”€å”®ã€è®¢å•å†œä¸šå®šé‡‘æˆ–é¢„ä»˜æ¬¾ã€åœŸåœ°æ‰˜ç®¡æœåŠ¡è´¹ã€å†œä¸šç‰©è”ç½‘è®¾å¤‡é”€å”®/ç§Ÿèµè´¹ã€æµ‹åœŸé…è‚¥æœåŠ¡æ”¶è´¹ã€è½®ä½œè§„åˆ’å’¨è¯¢è´¹ |
| ğŸ„ C | ğŸ· ç•œç‰§å…»æ®–ç±» | ç•œç¦½æ´»ä½“é”€å”®ï¼ˆçŒªç‰›ç¾Šé¸¡é¸­ï¼‰ã€ç¦½è›‹å¥¶äº§å“é”€å”®ã€é¥²æ–™ä»£åŠ å·¥è´¹ã€ç–«ç—…é˜²æ§ä¸åŠ¨ä¿æŠ€æœ¯æœåŠ¡è´¹ã€è‰¯ç§ç¹è‚²ä¸äººå·¥æˆç²¾æœåŠ¡è´¹ã€ç²ªæ±¡èµ„æºåŒ–å¤„ç†æœåŠ¡è´¹ã€ç”Ÿæ€å…»æ®–ç¢³æ±‡æŒ‡æ ‡äº¤æ˜“æ”¶å…¥ã€ç‰§åœºå‚è§‚ä½“éªŒé—¨ç¥¨ |
| ğŸŒ² D | ğŸªµ æ—ä¸šç»è¥ç±» | æ—ä¸‹ç»æµäº§å“é”€å”®ï¼ˆèŒè‡ã€è¯æã€å±±çï¼‰ã€æ—æœ¨é‡‡ä¼æƒè½¬è®©æˆ–åˆ†æˆã€æ—åœ°é•¿æœŸç§Ÿèµæ”¶å…¥ã€æ£®æ—åº·å…»ä½“éªŒæ”¶è´¹ã€æ—ä¸šç¢³æ±‡é¡¹ç›®äº¤æ˜“æ”¶ç›Šã€æ—æƒè¯„ä¼°ä¸æŠµæŠ¼å’¨è¯¢æœåŠ¡è´¹ |
| ğŸŸ E | ğŸŒŠ æ¸”ä¸šæ°´äº§ç±» | æ°´äº§å“æ‰¹å‘é›¶å”®æ”¶å…¥ã€æ± å¡˜/ç½‘ç®±æ‰¿åŒ…ç§Ÿé‡‘ã€é±¼è‹—ç§é”€å”®ã€å‚é’“å›­é—¨ç¥¨åŠé…å¥—æ¶ˆè´¹ã€æ°´äº§å“å“ç‰ŒåŠ ç›Ÿè´¹ã€å†·é“¾è¿è¾“åä½œåˆ†æˆã€æ¸”å…‰äº’è¡¥å‘ç”µä¸Šç½‘æ”¶å…¥ï¼ˆç»“åˆæ–°èƒ½æºï¼‰ |
| ğŸ—ï¸ F | ğŸ”¨ å»ºç­‘è¥é€ ç±»ï¼ˆå·¥ç¨‹å»ºè®¾ï¼‰ | å·¥ç¨‹æ€»æ‰¿åŒ…ï¼ˆEPCï¼‰æ”¶å…¥ã€å†œæ‘å±æˆ¿æ”¹é€ è¡¥è´´å›æ¬¾ã€è£…é…å¼å†œæˆ¿å»ºé€ è´¹ã€å°å‹æ°´åˆ©/çŒæº‰è®¾æ–½å»ºè®¾æ”¶å…¥ã€ç”°å›­ç»¼åˆä½“æ™¯è§‚æ–½å·¥è´¹ã€å»ºç­‘åŠ³åŠ¡åˆ†åŒ…æ”¶å…¥ã€å»ºæé›†ä¸­é‡‡è´­å·®ä»·æˆ–è¿”ç‚¹ã€è®¾è®¡å’¨è¯¢æœåŠ¡è´¹ã€BIMæŠ€æœ¯åº”ç”¨æœåŠ¡è´¹ã€é¡¹ç›®ä»£å»ºç®¡ç†è´¹ |
| ğŸ¢ G | ğŸ­ å»ºç­‘èµ„äº§è¿è¥ç±»ï¼ˆç©ºé—´ç§Ÿèµä¸æœåŠ¡ï¼‰ | æ ‡å‡†å‚æˆ¿ç§Ÿèµè´¹ã€å®šåˆ¶å‚æˆ¿å‡ºå”®æ”¶å…¥ã€å‚æˆ¿ä»£å»º+å›è´­åè®®æ”¶å…¥ã€å‘˜å·¥å®¿èˆ/äººæ‰å…¬å¯“ç§Ÿé‡‘ã€å•†ä¸šé—¨é¢/æ²¿è¡—å•†é“ºç§Ÿé‡‘ã€ç‰©ä¸šç®¡ç†è´¹ã€åœè½¦ä½ç§Ÿèµè´¹ã€æ¥¼å®‡å¹¿å‘Šä½å‡ºç§Ÿï¼ˆç”µæ¢¯/å¤–å¢™ï¼‰ã€å…¬å…±è®¾æ–½é…å¥—æœåŠ¡è´¹ï¼ˆç½‘ç»œã€å®‰ä¿ã€ä¼šåŠ¡ï¼‰ã€èƒ½æºç»Ÿä¾›å·®ä»·æ”¶ç›Šï¼ˆæ°´ç”µæ°”çƒ­ï¼‰ |
| ğŸï¸ H | ğŸŒ äº§ä¸šå›­åŒºç»¼åˆå¼€å‘ç±» | åœŸåœ°ä¸€çº§å¼€å‘æŠ•èµ„å›æŠ¥åˆ†æˆã€äºŒçº§å·¥ä¸šç”¨åœ°å‡ºè®©æº¢ä»·åˆ†æˆã€äº§ä¸šæ‹›å•†è½åœ°å¥–åŠ±ã€å›­åŒºæ•´ä½“å“ç‰Œè¾“å‡ºä¸å§”æ‰˜è¿è¥è´¹ã€ä¼ä¸šæ³¨å†Œä»£åŠæœåŠ¡è´¹ã€å­µåŒ–å™¨/ä¼—åˆ›ç©ºé—´å·¥ä½ç§Ÿé‡‘ã€æ”¿ä¼åˆä½œç‰¹è®¸ç»è¥æ”¶ç›Šï¼ˆå¦‚æ±¡æ°´å¤„ç†BOTï¼‰ã€å›­åŒºREITså‘è¡Œç®¡ç†è´¹ã€è½»èµ„äº§è¾“å‡ºç®¡ç†ææˆ |
| ğŸ’¼ I | ğŸ”„ äº¤æ˜“æ’®åˆç±» | å†œèµ„é›†ä¸­é‡‡è´­ä½£é‡‘ã€ä¸­è¯æäº§åœ°äº¤æ˜“æ‰‹ç»­è´¹ã€å†œæœºä½œä¸šè°ƒåº¦æœåŠ¡è´¹ã€å†œäº§å“ç”µå•†ä»£è¿è¥æœåŠ¡è´¹ã€åœŸåœ°ç»è¥æƒæµè½¬ä¸­ä»‹è´¹ã€å†œä¼èèµ„å¯¹æ¥æˆåŠŸå¥–åŠ±ã€è·¨å¢ƒå†œäº§å“è´¸æ˜“æ’®åˆä½£é‡‘ã€å‚æˆ¿ä»“åº“ç§Ÿèµä¿¡æ¯ä¸­ä»‹è´¹ã€å·¥ä¸šç”¨åœ°ä½¿ç”¨æƒè½¬è®©æ’®åˆè´¹ã€å•†ä¸šç‰©ä¸šè½¬ç§ŸæœåŠ¡æ‰‹ç»­è´¹ |
| ğŸ­ J | ğŸ”§ åŠ å·¥æœåŠ¡ç±» | å§”æ‰˜åŠ å·¥è´¹ï¼ˆä»£åŠ å·¥é¥®ç‰‡/é£Ÿå“ï¼‰ã€åˆåŠ å·¥æœåŠ¡è´¹ï¼ˆæ¸…æ´—ã€åˆ†çº§ã€çƒ˜å¹²ï¼‰ã€ä»“å‚¨ç§Ÿèµè´¹ã€å†·é“¾ä¿é²œæœåŠ¡è´¹ã€åŒ…è£…è®¾è®¡ä¸ä»£åŒ…è£…è´¹ã€æ¥æ–™åŠ å·¥é™„åŠ æ°´ç”µäººå·¥è´¹ã€æ·±åŠ å·¥é™„åŠ å€¼åˆä½œåˆ†æˆï¼ˆå¦‚è¯é£ŸåŒæºäº§å“ï¼‰ã€æ£€æµ‹æ£€éªŒé…å¥—æœåŠ¡è´¹ |
| ğŸŒ K | ğŸŒ¾ ç»¼åˆå†œæœç±»ï¼ˆå†œä¸šç”Ÿäº§æ€§æœåŠ¡ï¼‰ | å…¨ç¨‹æœºæ¢°åŒ–ä½œä¸šæœåŠ¡è´¹ï¼ˆè€•ç§ç®¡æ”¶ï¼‰ã€æ— äººæœºé£é˜²æœåŠ¡è´¹ã€åœŸå£¤æ£€æµ‹ä¸æ”¹è‰¯æ–¹æ¡ˆè´¹ã€æ™ºæ…§å†œä¸šç³»ç»Ÿé›†æˆæœåŠ¡è´¹ã€å†œä¸šé¡¹ç›®ç”³æŠ¥ä»£ç†è´¹ã€æ–°å‹èŒä¸šå†œæ°‘åŸ¹è®­è´¹ã€å“ç‰Œç­–åˆ’ä¸è®¤è¯è¾…å¯¼è´¹ã€å†œä¸šæ ‡å‡†åŒ–ä½“ç³»å»ºè®¾å’¨è¯¢è´¹ |
| ğŸ’¡ L | ğŸ”‹ æ–°èƒ½æºèåˆç±» | å†œå…‰äº’è¡¥å…‰ä¼å‘ç”µä¸Šç½‘æ”¶å…¥ã€æ²¼æ°”å·¥ç¨‹é›†ä¸­ä¾›æ°”æ”¶è´¹ã€å…‰ä¼å¤§æ£šç§Ÿèµåˆ†çº¢ã€ç§¸ç§†ç”Ÿç‰©è´¨èƒ½æºè½¬åŒ–æ”¶ç›Šã€å‚¨èƒ½ç³»ç»Ÿè¿è¥æœåŠ¡è´¹ã€ç¢³èµ„äº§ç®¡ç†å’¨è¯¢æœåŠ¡è´¹ã€ç»¿è¯äº¤æ˜“åˆ†æˆ |
| ğŸ›’ M | ğŸ‰ å†œæ—…èåˆç±» | æ°‘å®¿ç»è¥æ”¶å…¥ã€å†œäº‹ä½“éªŒæ´»åŠ¨é—¨ç¥¨ã€ç ”å­¦æ—…è¡Œæ¥å¾…æ”¶å…¥ã€ç‰¹è‰²å†œäº§å“ä¼´æ‰‹ç¤¼é”€å”®ã€èŠ‚åº†æ–‡æ—…æ´»åŠ¨ç­–åˆ’æ‰§è¡Œè´¹ã€ç”°å›­æ–‡æ—…IPæˆæƒä½¿ç”¨è´¹ã€éœ²è¥è¥åœ°æ”¶è´¹ã€äº²å­è‡ªç„¶æ•™è‚²è¯¾ç¨‹æ”¶å…¥ |
| ğŸ’° N | ğŸ“Š æ”¿ç­–ä¸é‡‘èæœåŠ¡ç±» | å†œä¸šä¿é™©åä¿è´¹åˆ†æˆã€å†œä¸šè¡¥è´´ç”³æŠ¥ä»£åŠæœåŠ¡è´¹ã€ä¸“é¡¹èµ„é‡‘ç¬¬ä¸‰æ–¹ç›‘ç®¡æœåŠ¡æ”¶å…¥ã€ç»¿è‰²é‡‘èäº§å“æ¨èå¥–åŠ±ã€æ¶‰å†œä¿¡è´·é£é™©è¡¥å¿åŸºé‡‘å‚ä¸åˆ†æˆã€REITsèµ„äº§æ‰“åŒ…é¡¾é—®è´¹ã€ESGè¯„çº§å’¨è¯¢æœåŠ¡è´¹ |

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š
{
  "selected_categories": [
    {
      "category_code": "ç±»åˆ«ä»£ç (A-N)",
      "category_name": "ç±»åˆ«åç§°",
      "category_icon": "ç±»åˆ«å›¾æ ‡",
      "relevance_score": 0.0-1.0çš„ç›¸å…³åº¦è¯„åˆ†,
      "reasoning": "ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªç±»åˆ«çš„ç®€çŸ­ç†ç”±ï¼ˆ50å­—ä»¥å†…ï¼‰",
      "recommended_revenue_types": [
        {
          "type_name": "å…·ä½“è¥ä¸šæ”¶å…¥ç±»å‹åç§°",
          "priority": "high|medium|low",
          "suggested_vat_rate": å¢å€¼ç¨ç‡(å¦‚0.13è¡¨ç¤º13%),
          "typical_pricing_model": "è®¡è´¹æ¨¡å¼è¯´æ˜ï¼ˆå¦‚ï¼šæŒ‰é¢ç§¯ã€æŒ‰æ•°é‡ã€æŒ‰æœåŠ¡æ¬¡æ•°ç­‰ï¼‰",
          "estimated_proportion": "é¢„è®¡å æ€»æ”¶å…¥çš„ç™¾åˆ†æ¯”(0-100)"
        }
      ]
    }
  ],
  "total_categories": é€‰ä¸­çš„ç±»åˆ«æ•°é‡,
  "analysis_summary": "æ•´ä½“åˆ†ææ€»ç»“ï¼ˆ100å­—ä»¥å†…ï¼Œè¯´æ˜é¡¹ç›®æ”¶å…¥ç»“æ„ç‰¹ç‚¹ï¼‰"
}

é€‰æ‹©è§„åˆ™ï¼š
1. æ ¹æ®é¡¹ç›®åç§°ã€æè¿°ã€å·¥ç¨‹é¡¹ç­‰ä¿¡æ¯ï¼Œåˆ†æé¡¹ç›®çš„äº§ä¸šç±»å‹å’Œå•†ä¸šæ¨¡å¼
2. ä»14ä¸ªç±»åˆ«ä¸­é€‰å‡º2-6ä¸ªæœ€ç›¸å…³çš„ç±»åˆ«ï¼ˆç›¸å…³åº¦è¯„åˆ†>0.6ï¼‰
3. æ¯ä¸ªç±»åˆ«æ¨è3-8ä¸ªæœ€åˆé€‚çš„å…·ä½“è¥ä¸šæ”¶å…¥ç±»å‹
4. æŒ‰ç›¸å…³åº¦ä»é«˜åˆ°ä½æ’åºç±»åˆ«
5. ä¸ºæ¯ä¸ªæ”¶å…¥ç±»å‹æ ‡æ³¨ä¼˜å…ˆçº§ï¼ˆhigh/medium/lowï¼‰å’Œå»ºè®®çš„å¢å€¼ç¨ç‡
6. ä¼°ç®—æ¯ä¸ªæ”¶å…¥ç±»å‹å æ€»æ”¶å…¥çš„å¤§è‡´æ¯”ä¾‹
7. æ‰€æœ‰æ¨èçš„æ”¶å…¥ç±»å‹å¿…é¡»æ¥è‡ªä¸Šè¿°14ä¸ªç±»åˆ«çš„å…·ä½“åˆ—è¡¨ï¼Œä¸è¦è‡ªå·±åˆ›é€ æ–°çš„ç±»å‹

åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜`

  const engineeringItemsText = engineeringItems && engineeringItems.length > 0
    ? `\nå·¥ç¨‹é¡¹æ˜ç»†ï¼š\n${engineeringItems.map(item => `- ${item.name}ï¼š${item.amount}ä¸‡å…ƒ`).join('\n')}`
    : ''

  const userPrompt = `é¡¹ç›®åç§°ï¼š${projectName}
é¡¹ç›®æè¿°ï¼š${projectDescription || 'æ— è¯¦ç»†æè¿°'}
æ€»æŠ•èµ„ï¼š${totalInvestment}ä¸‡å…ƒ${engineeringItemsText}

è¯·åˆ†æè¯¥é¡¹ç›®ï¼Œä»14ä¸ªç±»åˆ«ä¸­é€‰å‡ºæœ€åˆé€‚çš„è¥ä¸šæ”¶å…¥ç±»åˆ«ï¼Œå¹¶ä¸ºæ¯ä¸ªç±»åˆ«æ¨èå…·ä½“çš„è¥ä¸šæ”¶å…¥ç±»å‹ã€‚`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

export function analyzeProjectInfoPrompt(projectInfo: string): LLMMessage[] {
  const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¡¹ç›®åˆ†æåŠ©æ‰‹ã€‚è¯·ä»”ç»†åˆ†æç”¨æˆ·æä¾›çš„é¡¹ç›®ä¿¡æ¯æè¿°,æå–å…³é”®ä¿¡æ¯å¹¶ä»¥JSONæ ¼å¼è¿”å›ã€‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡º,æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»å¡«å†™:
{
  "project_name": "é¡¹ç›®åç§°",
  "total_investment": æ•°å€¼(å•ä½:ä¸‡å…ƒ),
  "construction_years": æ•´æ•°(å»ºè®¾å¹´é™,å•ä½:å¹´),
  "operation_years": æ•´æ•°(è¿è¥å¹´é™,å•ä½:å¹´),
  "loan_ratio": æ•°å€¼(è´·æ¬¾æ¯”ä¾‹,0-100çš„ç™¾åˆ†æ•°,å¦‚70è¡¨ç¤º70%),
  "loan_interest_rate": æ•°å€¼(è´·æ¬¾åˆ©ç‡,0-100çš„ç™¾åˆ†æ•°,å¦‚4.9è¡¨ç¤º4.9%),
  "land_mode": "A|B|C|D",
  "land_area": æ•°å€¼(åœŸåœ°é¢ç§¯,å•ä½:äº©),
  "land_unit_price": æ•°å€¼(åœŸåœ°å•ä»·,å•ä½:ä¸‡å…ƒ/äº©æˆ–ä¸‡å…ƒ/äº©/å¹´),
  "land_cost": æ•°å€¼(åœŸåœ°è´¹ç”¨,å•ä½:ä¸‡å…ƒ),
  "land_remark": "åœŸåœ°ä¿¡æ¯å¤‡æ³¨",
  "land_lease_area": æ•°å€¼(ç§Ÿèµé¢ç§¯,äº©,æ··åˆæ¨¡å¼æ—¶å¡«å†™),
  "land_lease_unit_price": æ•°å€¼(ç§Ÿèµå•ä»·,ä¸‡å…ƒ/äº©/å¹´,æ··åˆæ¨¡å¼æ—¶å¡«å†™),
  "land_purchase_area": æ•°å€¼(å¾åœ°é¢ç§¯,äº©,æ··åˆæ¨¡å¼æ—¶å¡«å†™),
  "land_purchase_unit_price": æ•°å€¼(å¾åœ°å•ä»·,ä¸‡å…ƒ/äº©,æ··åˆæ¨¡å¼æ—¶å¡«å†™),
  "seedling_compensation": æ•°å€¼(é’è‹—è¡¥å¿è´¹,ä¸‡å…ƒ,Aå’ŒDæ¨¡å¼æ—¶å¡«å†™)
}

åœŸåœ°æ¨¡å¼å†³ç­–é€»è¾‘ï¼š
1. A(ä¸€æ¬¡æ€§å¾åœ°): æ”¿åºœä¸»å¯¼ã€åŸºç¡€æ€§ã€æ°¸ä¹…æ€§é¡¹ç›®(å¦‚æ°´åº“ã€äº¤é€šæ¢çº½ã€æ•°æ®ä¸­å¿ƒ)
   - è®¡ç®—: land_cost = land_area Ã— land_unit_price + seedling_compensation
   - å¤‡æ³¨: "æŒ‰ä¸€æ¬¡æ€§å¾åœ°æ¨¡å¼,[N]äº©Ã—[å•ä»·]ä¸‡å…ƒ/äº© + é’è‹—è¡¥å¿[X]ä¸‡å…ƒä¼°ç®—ã€‚"
   - é’è‹—è¡¥å¿è´¹ä¸€èˆ¬ä¸ºå¾åœ°æ€»ä»·çš„10-20%

2. B(é•¿æœŸç§Ÿèµç”¨åœ°): å¸‚åœºåŒ–è¿è¥ã€çº¯å†œä¸šç§æ¤æˆ–å…»æ®–é¡¹ç›®
   - è®¡ç®—: land_cost = construction_years Ã— land_unit_price Ã— land_area
   - å¤‡æ³¨: "æŒ‰ç§Ÿåœ°æ¨¡å¼ä¼°ç®—,è®¡å…¥å»ºè®¾æœŸ[N]å¹´ç§Ÿé‡‘,[M]äº©Ã—[å•ä»·]ä¸‡å…ƒ/äº©/å¹´ã€‚"

3. C(æ— åœŸåœ°éœ€æ±‚): çº¯è½¯ä»¶ã€SaaSå¹³å°ç±»é¡¹ç›®
   - land_cost = 0
   - å¤‡æ³¨: "çº¯è½¯ä»¶ç±»é¡¹ç›®,æ— åœŸåœ°éœ€æ±‚ã€‚"

4. D(æ··åˆç”¨åœ°æ¨¡å¼): åŒ…å«ç§æ¤/å…»æ®–+åŠ å·¥/ä»“å‚¨ç­‰æ°¸ä¹…æ€§è®¾æ–½çš„é¡¹ç›®
   - éœ€è¦å¡«å†™: land_lease_area, land_lease_unit_price, land_purchase_area, land_purchase_unit_price, seedling_compensation
   - è®¡ç®—: land_cost = (construction_years Ã— land_lease_unit_price Ã— land_lease_area) + (land_purchase_area Ã— land_purchase_unit_price) + seedling_compensation
   - å¤‡æ³¨: "æ··åˆç”¨åœ°æ¨¡å¼ã€‚ç§Ÿèµéƒ¨åˆ†:[...]; å¾åœ°éƒ¨åˆ†:[...]; é’è‹—è¡¥å¿:[...]ä¸‡å…ƒ"

æ³¨æ„äº‹é¡¹:
1. å¦‚æœä¿¡æ¯ä¸­æ²¡æœ‰æ˜ç¡®è¯´æ˜æŸä¸ªå­—æ®µ,è¯·æ ¹æ®è¡Œä¸šæƒ¯ä¾‹ç»™å‡ºåˆç†ä¼°ç®—
2. è´·æ¬¾æ¯”ä¾‹ä¸€èˆ¬ä¸º60-80%
3. è´·æ¬¾åˆ©ç‡ä¸€èˆ¬ä¸º3-6%
4. å»ºè®¾å¹´é™ä¸€èˆ¬ä¸º2-5å¹´
5. è¿è¥å¹´é™ä¸€èˆ¬ä¸º17-30å¹´
6. åœŸåœ°å¾æ”¶ã€ç§Ÿèµå•ä»·æ ¹æ®é¡¹ç›®æ‰€åœ¨åœ°åŒºåŠã€Šå¹¿è¥¿å„åœ°åŒºåœŸåœ°å¾æ”¶ã€ç§Ÿèµå•ä»·åŒºé—´ã€‹æ¥ç¡®å®š
7. åªè¿”å›JSONæ ¼å¼,ä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜

å¹¿è¥¿å„åœ°åŒºåœŸåœ°å¾æ”¶ã€ç§Ÿèµå•ä»·åŒºé—´ï¼ˆ2024-2025å¹´ï¼Œå•ä½ï¼šå…ƒ/äº©ï¼‰

ä¸€ã€åœŸåœ°å¾æ”¶å•ä»·åŒºé—´ï¼ˆåŒºç‰‡ç»¼åˆåœ°ä»·ï¼Œå«åœŸåœ°è¡¥å¿è´¹+å®‰ç½®è¡¥åŠ©è´¹ï¼‰

| åœ°åŒº    | åŸºæœ¬å†œç”°      | å»ºè®¾ç”¨åœ°      | æœªåˆ©ç”¨åœ°      | å…¸å‹åŒºåŸŸ           |
|---------|---------------|---------------|---------------|--------------------|
| å—å®    | 3.5~4.8ä¸‡     | 1.4~1.8ä¸‡     | 0.4~1.8ä¸‡     | è‰¯åº†åŒºã€æ­¦é¸£å¿     |
| æŸ³å·    | 3.8~4.4ä¸‡     | 1.4~1.6ä¸‡     | 0.35~1.6ä¸‡    | å¸‚è¾–åŒºã€æŸ³æ±ŸåŒº     |
| æ¡‚æ—    | 3.6~6.5ä¸‡     | 1.3~2.4ä¸‡     | 0.3~2.4ä¸‡     | ä¸´æ¡‚åŒºã€é¾™èƒœå¿     |
| æ¢§å·    | 3.6~4.4ä¸‡     | 1.3~1.6ä¸‡     | 0.3~1.6ä¸‡     | è—¤å¿ã€è’™å±±å¿       |
| åŒ—æµ·    | 3.5~4.2ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | å¸‚è¾–åŒº             |
| é˜²åŸæ¸¯  | 3.5~4.0ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | æ¸¯å£åŒºã€ä¸œå…´å¸‚     |
| é’¦å·    | 3.5~4.2ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | å¸‚è¾–åŒº             |
| è´µæ¸¯    | 3.5~4.0ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | æ¸¯åŒ—åŒºã€å¹³å—å¿     |
| ç‰æ—    | 3.5~4.0ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | ç‰å·åŒº             |
| ç™¾è‰²    | 3.5~4.2ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | ç”°é˜³åŒºã€å³æ±ŸåŒº     |
| è´ºå·    | 3.5~4.0ä¸‡     | 1.3~1.5ä¸‡     | 0.3~1.5ä¸‡     | å…«æ­¥åŒº             |
| æ²³æ±     | 3.5~8.3ä¸‡     | 1.3~3.0ä¸‡     | 0.3~3.0ä¸‡     | é‡‘åŸæ±ŸåŒºã€å®œå·åŒº   |
| æ¥å®¾    | 3.5~4.3ä¸‡     | 1.3~1.6ä¸‡     | 0.3~1.6ä¸‡     | å…´å®¾åŒºã€è±¡å·å¿     |
| å´‡å·¦    | 3.5~3.6ä¸‡     | 1.3~1.4ä¸‡     | 0.3~1.4ä¸‡     | æ±Ÿå·åŒºã€å‡­ç¥¥å¸‚     |

äºŒã€åœŸåœ°ç§Ÿèµå•ä»·åŒºé—´ï¼ˆå®é™…æˆäº¤ä¸å¸‚åœºè¡Œæƒ…ï¼‰

| åœ°åŒº    | å†œä¸šç”¨åœ°ï¼ˆå…ƒ/äº©/å¹´ï¼‰ | å·¥ä¸šç”¨åœ°ï¼ˆå…ƒ/äº©/å¹´ï¼‰ | å»ºè®¾ç”¨åœ°ï¼ˆå…ƒ/äº©/å¹´ï¼‰ | å¸‚åœºæ¡ˆä¾‹è¯´æ˜                  |
|---------|----------------------|----------------------|----------------------|-------------------------------|
| å—å®    | 500~2000             | 1.5ä¸‡~5ä¸‡            | 0.8ä¸‡~2ä¸‡            | å®¾é˜³å¿å·¥ä¸šç”¨åœ°æŒ‚ç‰Œ5ä¸‡/äº©/å¹´   |
| æŸ³å·    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | æŸ³å·å·¥ä¸šç”¨åœ°æˆäº¤çº¦15.7ä¸‡/äº©ï¼ˆæŠ˜å¹´ç§Ÿçº¦1.6ä¸‡ï¼‰ |
| æ¡‚æ—    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | å†œä¸šåœ°æ™®é1000-1500å…ƒ/äº©/å¹´  |
| æ¢§å·    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| åŒ—æµ·    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| é˜²åŸæ¸¯  | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| é’¦å·    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| è´µæ¸¯    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| ç‰æ—    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| ç™¾è‰²    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| è´ºå·    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| æ²³æ±     | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | å¤©å³¨å¿å·¥ä¸šç”¨åœ°æŒ‚ç‰Œ1300å…ƒ/äº©/å¹´|
| æ¥å®¾    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | â€”                             |
| å´‡å·¦    | 500~2000             | 1.5ä¸‡~4ä¸‡            | 0.8ä¸‡~2ä¸‡            | å‡­ç¥¥å¸‚å·¥ä¸šç”¨åœ°1.5ä¸‡/äº©/å¹´     |




`

  const userPrompt = `è¯·åˆ†æä»¥ä¸‹é¡¹ç›®ä¿¡æ¯å¹¶æå–å…³é”®æ•°æ®:

${projectInfo}

è¯·è¿”å›JSONæ ¼å¼çš„ç»“æ„åŒ–æ•°æ®ã€‚`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

/**
 * åˆ†æè¥ä¸šæ”¶å…¥ç±»å‹çš„ç¨ç‡å’Œè®¡è´¹æ¨¡å¼
 */
export function analyzePricingPrompt(typeName: string): LLMMessage[] {
  const systemPrompt = `ä½œä¸ºä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡é¡¾é—®ï¼Œæ ¹æ®è¥ä¸šæ”¶å…¥ç±»å‹çš„åç§°ï¼Œæ¨ç†å…¶åˆé€‚çš„å¢å€¼ç¨ç¨ç‡å’Œè®¡è´¹æ¨¡å¼ã€‚

å‚è€ƒè§„åˆ™ï¼š
- å†œäº§å“é”€å”®ï¼š9%
- æœåŠ¡ä¸šï¼š6%
- å·¥ä¸šäº§å“é”€å”®ï¼š13%
- ç§ŸèµæœåŠ¡ï¼š9%
- ä¸åŠ¨äº§ç§Ÿèµï¼š9%
- ç°ä»£æœåŠ¡ï¼ˆå’¨è¯¢ã€æŠ€æœ¯ï¼‰ï¼š6%
- ç”Ÿæ´»æœåŠ¡ï¼š6%

è®¡è´¹æ¨¡å¼ç¤ºä¾‹ï¼š
- é”€å”®ç±»ï¼šæŒ‰é‡é‡é”€å”®ã€æŒ‰æ•°é‡é”€å”®ã€æŒ‰ä»¶é”€å”®
- æœåŠ¡ç±»ï¼šæŒ‰æœåŠ¡æ¬¡æ•°ã€æŒ‰é¢ç§¯ã€æŒ‰å°æ—¶ã€æŒ‰å¤©
- ç§Ÿèµç±»ï¼šæŒ‰æœˆç§Ÿèµã€æŒ‰å¹´ç§Ÿèµã€æŒ‰å¹³æ–¹ç±³
- è®¢é˜…ç±»ï¼šæŒ‰æœˆè®¢é˜…ã€æŒ‰å¹´è®¢é˜…
- åŠ å·¥ç±»ï¼šæŒ‰é‡é‡åŠ å·¥ã€æŒ‰ä»¶åŠ å·¥
- æŠ€æœ¯ç±»ï¼šæŒ‰é¡¹ç›®æŠ¥ä»·ã€æŒ‰å·¥ä½œé‡

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{
  "vat_rate": å¢å€¼ç¨ç‡ï¼ˆå•ä½ï¼š%ï¼Œå¦‚ï¼š9ã€13ã€6ï¼‰,
  "pricing_model": "è®¡è´¹æ¨¡å¼ï¼ˆä¸è¶…è¿‡15å­—ï¼‰"
}

åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜`

  const userPrompt = `è¥ä¸šæ”¶å…¥ç±»å‹ï¼š${typeName}

è¯·åˆ†æå…¶åˆé€‚çš„å¢å€¼ç¨ç¨ç‡å’Œè®¡è´¹æ¨¡å¼ã€‚`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}

/**
 * æ ¹æ®é¡¹ç›®ä¿¡æ¯å’Œè¥æ”¶ç»“æ„è¡¨ç”Ÿæˆå…·ä½“çš„æ”¶å…¥é¡¹ç›®è¡¨
 */
export function generateRevenueItemsPrompt(
  projectInfo: {
    name: string
    description: string
    totalInvestment: number
    constructionYears: number
    operationYears: number
    constructionCost?: number
    equipmentCost?: number
  },
  revenueSummary: string
): LLMMessage[] {
  const systemPrompt = `ä½œä¸ºä¸€ä¸ªä¸“ä¸šçš„è´¢åŠ¡åˆ†æå¸ˆï¼Œæ ¹æ®é¡¹ç›®ä¿¡æ¯ã€æŠ•èµ„æ•°æ®å’Œè¥æ”¶ç»“æ„è¡¨ï¼Œç”Ÿæˆè¯¦ç»†çš„è¥ä¸šæ”¶å…¥é¡¹ç›®è¡¨ã€‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
{
  "revenue_items": [
    {
      "name": "æ”¶å…¥é¡¹åç§°",
      "category": "agriculture-crop | agriculture-livestock | agriculture-aquaculture | digital-platform | transaction-hub | processing | agri-service | new-energy | agri-tourism | other",
      "unit": "è®¡é‡å•ä½",
      "quantity": å¹´äº§é‡æ•°å€¼,
      "unitPrice": å•ä»·æ•°å€¼(å…ƒ),
      "vatRate": å¢å€¼ç¨ç‡æ•°å€¼(%)
    }
  ]
}

ç±»åˆ«æšä¸¾å€¼è¯´æ˜ï¼š
- agriculture-crop: å†œä¸šç§æ¤
- agriculture-livestock: ç•œç‰§å…»æ®–
- agriculture-aquaculture: æ¸”ä¸šæ°´äº§
- digital-platform: æ•°å­—å¹³å°
- transaction-hub: äº¤æ˜“æ’®åˆ
- processing: åŠ å·¥æœåŠ¡
- agri-service: ç»¼åˆå†œæœ
- new-energy: æ–°èƒ½æºèåˆ
- agri-tourism: å†œæ—…èåˆ
- other: å…¶ä»–

è¦æ±‚ï¼š
1. ç”Ÿæˆ 3-8 ä¸ªæ”¶å…¥é¡¹ç›®ï¼Œè¦†ç›–ä¸»è¦è¥æ”¶ç±»å‹
2. æ•°æ®è¦ç¬¦åˆè¡Œä¸šå¸¸è¯†å’Œé¡¹ç›®è§„æ¨¡
3. category å¿…é¡»æ˜¯ä¸Šè¿°æšä¸¾å€¼ä¹‹ä¸€
4. å¢å€¼ç¨ç‡å‚è€ƒï¼šå†œäº§å“ 9%ã€æœåŠ¡ä¸š 6%ã€å·¥ä¸šäº§å“ 13%
5. å•ä»·ä»¥"å…ƒ"ä¸ºå•ä½
6. å¹´äº§é‡/è§„æ¨¡è¦ç¬¦åˆå®é™…ï¼Œè€ƒè™‘é¡¹ç›®æŠ•èµ„è§„æ¨¡
7. åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—è¯´æ˜`

  const investmentSummary = `
æ€»æŠ•èµ„ï¼š${projectInfo.totalInvestment}ä¸‡å…ƒ
å»ºè®¾æœŸï¼š${projectInfo.constructionYears}å¹´
è¿è¥æœŸï¼š${projectInfo.operationYears}å¹´${projectInfo.constructionCost ? `
å»ºç­‘å·¥ç¨‹è´¹ï¼š${projectInfo.constructionCost}ä¸‡å…ƒ` : ''}${projectInfo.equipmentCost ? `
è®¾å¤‡è´­ç½®è´¹ï¼š${projectInfo.equipmentCost}ä¸‡å…ƒ` : ''}
  `.trim()

  const userPrompt = `è¯·ä¸ºä»¥ä¸‹é¡¹ç›®ç”Ÿæˆè¯¦ç»†çš„è¥ä¸šæ”¶å…¥é¡¹ç›®è¡¨ï¼š

## é¡¹ç›®åŸºæœ¬ä¿¡æ¯
é¡¹ç›®åç§°ï¼š${projectInfo.name}
é¡¹ç›®æè¿°ï¼š${projectInfo.description || 'æ— '}

## æŠ•èµ„ç®€è¡¨æ•°æ®
${investmentSummary}

## è¥æ”¶ç»“æ„è¡¨
${revenueSummary}

è¯·æ ¹æ®ä¸Šè¿°ä¿¡æ¯ï¼Œç”Ÿæˆåˆç†çš„è¥ä¸šæ”¶å…¥é¡¹ç›®è¡¨ã€‚ç¡®ä¿ï¼š
1. æ”¶å…¥é¡¹ä¸è¥æ”¶ç»“æ„è¡¨å¯¹åº”
2. è§„æ¨¡ä¸æŠ•èµ„é¢åŒ¹é…
3. æ•°æ®ç¬¦åˆè¡Œä¸šå¸¸è¯†`

  return [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ]
}