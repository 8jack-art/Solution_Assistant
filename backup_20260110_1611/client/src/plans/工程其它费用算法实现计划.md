# 工程其它费用算法实现计划

## 目标
修改 `server/src/lib/algorithms/partBCalculation.ts` 中的三个计算函数，实现用户提供的分档内插算法。

## 需要修改的函数

### 1. `calculateSupervisionFee(partATotal: number): number`

**修改内容：**
- 将简化的百分比计算改为16档分档内插计算
- 基数：工程费用 = 建设工程费 + 安装工程费

**数据表：**

| 序号 | 工程费用(万元) | 收费基价(万元) |
|------|----------------|----------------|
| 1 | 500 | 13.20 |
| 2 | 1000 | 24.08 |
| 3 | 3000 | 62.48 |
| 4 | 5000 | 96.64 |
| 5 | 8000 | 144.80 |
| 6 | 10000 | 174.88 |
| 7 | 20000 | 314.72 |
| 8 | 40000 | 566.56 |
| 9 | 60000 | 793.12 |
| 10 | 80000 | 1004.64 |
| 11 | 100000 | 1205.60 |
| 12 | 200000 | 2170.00 |
| 13 | 400000 | 3906.08 |
| 14 | 600000 | 5468.48 |
| 15 | 800000 | 6926.72 |
| 16 | 1000000 | 8312.08 |

**内插公式：**
```
收费基价下限 + (收费基价上限 - 收费基价下限) × (工程费用 - 下限值) / (上限值 - 下限值)
```

---

### 2. `calculatePreliminaryConsultingFee(partATotal: number): number`

**修改内容：**
- 将简化的百分比计算改为按总投资额分档内插
- 返回5个子项之和

**5个子项：**
1. 编制项目建议书
2. 编制可行性研究报告
3. 评估项目建议书
4. 评估可行性研究报告
5. 初步设计文件评估咨询

**数据表（万元）：**

| 区间 | 500万↓ | 500万~1000万 | 1000万~3000万 | 3000万~1亿 |
|------|--------|--------------|---------------|------------|
| 编制项目建议书 | 0.8~1.2 | 1.2~2.0 | 2.0~4.8 | 4.8~11.2 |
| 编制可研报告 | 1.6~3.2 | 3.2~4.8 | 4.8~9.6 | 9.6~22.4 |
| 评估项目建议书 | 0.4~0.8 | 0.8~1.2 | 1.2~3.2 | 3.2~6.4 |
| 评估可研报告 | 0.8~1.2 | 1.2~2.0 | 2.0~4.0 | 4~8 |
| 初步设计评估 | 0.8~1.2 | 1.2~2.0 | 2.0~4.0 | 4~8 |

| 区间 | 1亿~5亿 | 5亿~10亿 | 10亿~50亿 | 50亿↑ |
|------|---------|----------|-----------|-------|
| 编制项目建议书 | 11.2~29.6 | 29.6~44 | 44~80 | 80~100 |
| 编制可研报告 | 22.4~60 | 60~88 | 88~160 | 160~200 |
| 评估项目建议书 | 6.4~9.6 | 9.6~12 | 12~13.6 | 13.6~16 |
| 评估可研报告 | 8~12 | 12~16 | 16~20 | 20~28 |
| 初步设计评估 | 8~12 | 12~16 | 16~20 | 20~28 |

---

### 3. `calculateSurveyDesignFee(partATotal: number): number`

**修改内容：**
- 勘察费 = 初勘及详细勘察费 + 施工勘察费
- 设计费 = 基本设计费 + 竣工图编制费

**勘察费：**
- 初勘及详细勘察费 = 工程费用 × 0.3%
- 施工勘察费 = 工程费用 × 1.2%

**设计费：**

基本设计费收费基价表（万元）：

| 序号 | 工程费计费额 | 收费基价 |
|------|--------------|----------|
| 1 | 200 | 8.10 |
| 2 | 500 | 18.81 |
| 3 | 1,000 | 34.92 |
| 4 | 3,000 | 93.42 |
| 5 | 5,000 | 147.51 |
| 6 | 8,000 | 224.64 |
| 7 | 10,000 | 274.32 |
| 8 | 20,000 | 510.12 |
| 9 | 40,000 | 948.60 |
| 10 | 60,000 | 1,363.68 |
| 11 | 80,000 | 1,764.09 |
| 12 | 100,000 | 2,154.06 |
| 13 | 200,000 | 4,005.72 |
| 14 | 400,000 | 7,449.03 |
| 15 | 600,000 | 10,707.75 |
| 16 | 800,000 | 13,852.26 |
| 17 | 1,000,000 | 16,914.42 |
| 18 | 2,000,000 | 31,454.01 |

**系数：**
- 复杂度系数：默认 1.0
- 附加系数：1.10

**计算公式：**
- 基本设计费 = 基本取费 × 复杂度系数 × 附加系数
- 竣工图编制费 = 基本设计费 × 8%

---

## 实现步骤

1. **修改 `calculateSupervisionFee` 函数**
   - 添加分档内插数据表
   - 实现内插算法
   - 测试验证

2. **修改 `calculatePreliminaryConsultingFee` 函数**
   - 添加5个子项的分档数据
   - 实现按总投资额分档内插
   - 返回5个子项之和

3. **修改 `calculateSurveyDesignFee` 函数**
   - 勘察费：按费率计算
   - 设计费：添加分档内插数据表
   - 竣工图编制费：按8%计算
   - 返回勘察费 + 设计费之和

4. **更新 `partCalculation.ts`**
   - 可能需要返回更详细的子项数据（如前期咨询费的5个子项分开显示）

---

## 注意事项

1. 需要区分"工程费用"（建设工程费+安装工程费）和"总投资"的概念
2. 内插算法需要处理边界情况（刚好等于档位值、小于最小档、大于最大档）
3. 建议抽取公共的内插计算函数，避免重复代码
