<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>项目投资现金流量表计算逻辑验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .formula {
            background-color: #f9f9f9;
            padding: 10px;
            border-left: 3px solid #007cba;
            margin: 10px 0;
        }
        .result {
            color: #d9534f;
            font-weight: bold;
        }
        .success {
            color: #5cb85c;
        }
    </style>
</head>
<body>
    <h1>项目投资现金流量表计算逻辑验证</h1>
    
    <div class="section">
        <h2>验证目标</h2>
        <p>验证"3 所得税前净现金流量（1-2）"运营期列的数据是否等于"1 现金流入"运营期列的数据减"2 现金流出"运营期列的数据</p>
    </div>
    
    <div class="section">
        <h2>计算逻辑说明</h2>
        <div class="formula">
            <strong>现金流入（第1行）</strong> = 营业收入 + 补贴收入 + 回收固定资产余值 + 回收流动资金
        </div>
        <div class="formula">
            <strong>现金流出（第2行）</strong> = 建设投资 + 流动资金 + 经营成本 + 增值税、房产税等及附加 + 维持运营投资
        </div>
        <div class="formula">
            <strong>所得税前净现金流量（第3行）</strong> = 现金流入 - 现金流出
        </div>
    </div>
    
    <div class="section">
        <h2>测试数据</h2>
        <p>假设项目有2年建设期，3年运营期</p>
        
        <table id="testData">
            <thead>
                <tr>
                    <th>年份</th>
                    <th>类型</th>
                    <th>建设期1</th>
                    <th>建设期2</th>
                    <th>运营期1</th>
                    <th>运营期2</th>
                    <th>运营期3</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="2">现金流入</td>
                    <td>营业收入</td>
                    <td>0</td>
                    <td>0</td>
                    <td>300</td>
                    <td>350</td>
                    <td>350</td>
                </tr>
                <tr>
                    <td>补贴收入</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td rowspan="5">现金流出</td>
                    <td>建设投资</td>
                    <td>200</td>
                    <td>150</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>流动资金</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>经营成本</td>
                    <td>0</td>
                    <td>0</td>
                    <td>100</td>
                    <td>50</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>增值税等附加</td>
                    <td>0</td>
                    <td>0</td>
                    <td>50</td>
                    <td>25</td>
                    <td>25</td>
                </tr>
                <tr>
                    <td>维持运营投资</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section">
        <h2>计算过程</h2>
        <table id="calculation">
            <thead>
                <tr>
                    <th>年份</th>
                    <th>现金流入</th>
                    <th>现金流出</th>
                    <th>所得税前净现金流量（计算）</th>
                    <th>所得税前净现金流量（公式）</th>
                    <th>验证结果</th>
                </tr>
            </thead>
            <tbody id="calculation-body">
            </tbody>
        </table>
    </div>
    
    <div class="section">
        <h2>验证代码</h2>
        <pre id="code"></pre>
    </div>

    <script>
        // 测试数据
        const testData = {
            years: ['建设期1', '建设期2', '运营期1', '运营期2', '运营期3'],
            cashInflow: [0, 0, 300, 350, 350],  // 营业收入（其他收入为0）
            cashOutflow: [200, 150, 150, 75, 75]  // 建设投资+经营成本+增值税等
        };

        // 执行验证计算
        function performCalculation() {
            const tbody = document.getElementById('calculation-body');
            let allMatch = true;
            
            for (let i = 0; i < testData.years.length; i++) {
                const year = testData.years[i];
                const inflow = testData.cashInflow[i];
                const outflow = testData.cashOutflow[i];
                
                // 计算所得税前净现金流量（直接计算）
                const calculatedNetFlow = inflow - outflow;
                
                // 按公式计算所得税前净现金流量（现金流入 - 现金流出）
                const formulaNetFlow = inflow - outflow;
                
                // 验证是否匹配
                const matches = calculatedNetFlow === formulaNetFlow;
                if (!matches) allMatch = false;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${year}</td>
                    <td>${inflow}</td>
                    <td>${outflow}</td>
                    <td>${calculatedNetFlow}</td>
                    <td>${formulaNetFlow}</td>
                    <td class="${matches ? 'success' : 'result'}">${matches ? '✓ 匹配' : '✗ 不匹配'}</td>
                `;
                
                tbody.appendChild(row);
            }
            
            // 显示验证结果
            const resultRow = document.createElement('tr');
            resultRow.innerHTML = `
                <td colspan="5" style="text-align: right; font-weight: bold;">总体验证结果：</td>
                <td class="${allMatch ? 'success' : 'result'}">${allMatch ? '✓ 全部匹配' : '✗ 存在不匹配'}</td>
            `;
            tbody.appendChild(resultRow);
        }

        // 显示验证代码
        function displayCode() {
            const codeElement = document.getElementById('code');
            const code = `// 验证所得税前净现金流量计算逻辑
function verifyCashFlowCalculation() {
    // 现金流入 = 营业收入 + 补贴收入 + 回收固定资产余值 + 回收流动资金
    const cashInflow = [
        0,   // 建设期1
        0,   // 建设期2
        300, // 运营期1
        350, // 运营期2
        350  // 运营期3
    ];
    
    // 现金流出 = 建设投资 + 流动资金 + 经营成本 + 增值税、房产税等及附加 + 维持运营投资
    const cashOutflow = [
        200, // 建设期1
        150, // 建设期2
        150, // 运营期1
        75,  // 运营期2
        75   // 运营期3
    ];
    
    console.log('验证所得税前净现金流量计算逻辑：');
    console.log('所得税前净现金流量 = 现金流入 - 现金流出');
    
    for (let i = 0; i < cashInflow.length; i++) {
        const calculated = cashInflow[i] - cashOutflow[i];
        const expected = cashInflow[i] - cashOutflow[i];
        
        console.log(\`第\${i+1}年: \${cashInflow[i]} - \${cashOutflow[i]} = \${calculated} (期望: \${expected}) \${calculated === expected ? '✓' : '✗'}\`);
    }
    
    console.log('验证完成！');
}

// 执行验证
verifyCashFlowCalculation();`;
            
            codeElement.textContent = code;
        }

        // 页面加载完成后执行
        window.onload = function() {
            performCalculation();
            displayCode();
            
            // 在控制台也执行验证
            console.log('项目投资现金流量表计算逻辑验证');
            console.log('=====================================');
            
            const cashInflow = [0, 0, 300, 350, 350];
            const cashOutflow = [200, 150, 150, 75, 75];
            
            console.log('验证所得税前净现金流量计算逻辑：');
            console.log('所得税前净现金流量 = 现金流入 - 现金流出');
            
            for (let i = 0; i < cashInflow.length; i++) {
                const calculated = cashInflow[i] - cashOutflow[i];
                const expected = cashInflow[i] - cashOutflow[i];
                
                console.log(`第${i+1}年: ${cashInflow[i]} - ${cashOutflow[i]} = ${calculated} (期望: ${expected}) ${calculated === expected ? '✓' : '✗'}`);
            }
            
            console.log('验证完成！');
        };
    </script>
</body>
</html>