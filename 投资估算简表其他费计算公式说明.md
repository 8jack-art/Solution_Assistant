# 投资估算简表其他费计算公式说明

根据从备份文件中查找的结果，投资估算简表中的"其他费"有两个不同的计算场景：

## 1. 投资估算简表中的其他费（第二部分工程其他费用中的第13项）

在投资估算简表的第二部分工程其他费用中，第13项为"其它"费用：

### 计算公式
```
其它费用 = 第一部分工程费用 × 0.5%
```

### 代码实现
文件位置：`server/src/lib/algorithms/partBCalculation.ts`

```typescript
/**
 * 计算其它费用
 * 按第一部分工程费用的0.5%计取
 * @param partATotal 第一部分工程费用总额（万元）
 * @returns 其它费用（万元）
 */
export function calculateOtherFee(partATotal: number): number {
  return partATotal * 0.005
}
```

### 在投资估算表中的位置
- 序号：13
- 工程或费用名称：其它
- 备注：按第一部分工程费的0.5%计取

## 2. 总成本费用估算表中的其他费用（1.5 其他费用）

在总成本费用估算表中，1.5项为"其他费用"，这是运营期间的费用：

### 计算公式
其他费用有两种计算方式：

#### 方式1：按收入百分比计算
```
其他费用 = 项目总收入 × 设定的百分比 × 达产率
```

#### 方式2：直接金额计算
```
其他费用 = 设定的直接金额 × 达产率
```

### 代码实现
文件位置：`client/src/components/revenue-cost/DynamicCostTable.tsx`

```typescript
// 1.5 其他费用计算
const productionRate = costConfig.otherExpenses.applyProductionRate
  ? (productionRates.find(p => p.yearIndex === year)?.rate || 1)
  : 1;

let yearTotal = 0;
if (costConfig.otherExpenses.type === 'percentage') {
  const revenueBase = (revenueItems || []).reduce((sum, revItem) => {
    const income = calculateTaxableIncome(revItem);
    return sum + income;
  }, 0);
  yearTotal += revenueBase * (costConfig.otherExpenses.percentage || 0) / 100 * productionRate;
} else {
  yearTotal += (costConfig.otherExpenses.directAmount || 0) * productionRate;
}
```

### 配置参数
- `type`: 计算类型（'percentage' | 'directAmount'）
- `percentage`: 收入百分比（当type为'percentage'时使用）
- `directAmount`: 直接金额（当type为'directAmount'时使用）
- `applyProductionRate`: 是否应用达产率（布尔值）

## 区别总结

1. **投资估算简表中的其他费**：
   - 属于建设期费用
   - 按第一部分工程费用的0.5%计算
   - 一次性费用

2. **总成本费用估算表中的其他费用**：
   - 属于运营期费用
   - 可选择按收入百分比或直接金额计算
   - 可选择是否应用达产率
   - 按年计算，贯穿整个运营期

这两个"其他费"是不同阶段、不同性质的费用，计算公式和用途完全不同。