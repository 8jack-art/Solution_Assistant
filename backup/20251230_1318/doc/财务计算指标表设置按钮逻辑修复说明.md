# 财务计算指标表设置按钮逻辑修复说明

## 问题描述
在财务计算指标表modal中，点击设置按钮后，弹出的modal逻辑不正确。

## 问题分析
1. 当前设置按钮的点击处理逻辑（第2792-2796行）：
   ```typescript
   onClick={(e) => {
     e.stopPropagation();
     setShowFinancialIndicatorsSettings(true);
   }}
   ```

2. 问题所在：
   - 设置modal是独立于财务指标表modal的
   - 当设置modal打开时，它应该显示在财务指标表modal的上方，而不是替换它
   - 在财务指标表modal的关闭处理中（第2778-2782行），当关闭财务指标表modal时，也会关闭设置modal，这种处理方式会导致用户体验不佳

## 修复方案
1. 修改设置按钮的点击处理逻辑：
   - 先关闭财务指标表modal
   - 然后打开设置modal
   - 使用setTimeout确保设置modal在财务指标表modal关闭后再打开

2. 修改后的代码：
   ```typescript
   onClick={(e) => {
     e.stopPropagation();
     // 先关闭财务指标表modal，然后打开设置modal
     setShowFinancialIndicatorsModal(false);
     // 使用setTimeout确保设置modal在财务指标表modal关闭后再打开
     setTimeout(() => {
       setShowFinancialIndicatorsSettings(true);
     }, 100);
   }}
   ```

3. 修改设置modal的关闭处理逻辑：
   - 在设置modal关闭后，重新打开财务指标表modal
   - 这样可以保持用户的操作流程连贯

## 具体修改内容

### 1. 修改设置按钮的点击处理逻辑
```typescript
// 修改前
onClick={(e) => {
  e.stopPropagation();
  setShowFinancialIndicatorsSettings(true);
}}

// 修改后
onClick={(e) => {
  e.stopPropagation();
  // 先关闭财务指标表modal，然后打开设置modal
  setShowFinancialIndicatorsModal(false);
  // 使用setTimeout确保设置modal在财务指标表modal关闭后再打开
  setTimeout(() => {
    setShowFinancialIndicatorsSettings(true);
  }, 100);
}}
```

### 2. 修改设置modal的确定按钮逻辑
```typescript
// 修改前
onClick={() => {
  // 保存设置并关闭弹窗
  localStorage.setItem('financialIndicatorsPreTaxRate', preTaxRate.toString());
  localStorage.setItem('financialIndicatorsPostTaxRate', postTaxRate.toString());
  
  // 强制刷新财务指标表
  setFinancialIndicatorsRefreshKey(prev => prev + 1);
  setShowFinancialIndicatorsSettings(false);
}}

// 修改后
onClick={() => {
  // 保存设置并关闭弹窗
  localStorage.setItem('financialIndicatorsPreTaxRate', preTaxRate.toString());
  localStorage.setItem('financialIndicatorsPostTaxRate', postTaxRate.toString());
  
  // 强制刷新财务指标表
  setFinancialIndicatorsRefreshKey(prev => prev + 1);
  setShowFinancialIndicatorsSettings(false);
  
  // 重新打开财务指标表modal，保持用户操作流程连贯
  setTimeout(() => {
    setShowFinancialIndicatorsModal(true);
  }, 100);
}}
```

### 3. 修改设置modal的取消按钮逻辑
```typescript
// 修改前
onClick={() => setShowFinancialIndicatorsSettings(false)}

// 修改后
onClick={() => {
  setShowFinancialIndicatorsSettings(false);
  // 重新打开财务指标表modal，保持用户操作流程连贯
  setTimeout(() => {
    setShowFinancialIndicatorsModal(true);
  }, 100);
}}
```

### 4. 修改设置modal的关闭按钮逻辑
```typescript
// 修改前
onClose={() => setShowFinancialIndicatorsSettings(false)}

// 修改后
onClose={() => {
  setShowFinancialIndicatorsSettings(false);
  // 重新打开财务指标表modal，保持用户操作流程连贯
  setTimeout(() => {
    setShowFinancialIndicatorsModal(true);
  }, 100);
}}
```

## 预期效果
- 点击设置按钮后，财务指标表modal会先关闭
- 然后设置modal会打开
- 在设置modal中完成设置后，关闭设置modal会重新打开财务指标表modal
- 用户操作流程更加连贯和直观

## 测试步骤
1. 打开财务计算指标表modal
2. 点击设置按钮
3. 验证财务指标表modal关闭，设置modal打开
4. 在设置modal中修改设置值
5. 点击确定按钮
6. 验证设置modal关闭，财务指标表modal重新打开
7. 验证设置值已保存并应用