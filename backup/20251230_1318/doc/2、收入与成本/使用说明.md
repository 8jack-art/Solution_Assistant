# 收入及成本预测模块 - 使用说明

## 📋 功能概述

收入及成本预测模块是投资项目管理系统的核心功能之一，用于对项目的营业收入、营业成本进行详细建模和预测，为后续的财务评价提供数据基础。

## 🚀 快速开始

### 1. 访问入口

在投资估算简表页面，点击右侧浮动按钮组中的 **"收入及成本预测"** 按钮（图标：📊）

**重要提示**：
- ⚠️ 只有当差距率 < 1.5% 时，该按钮才可用
- ✅ 差距率越小，说明投资估算越准确，此时进行收入成本预测更合理

### 2. 工作流程

收入及成本预测采用5步骤工作流：

```
计算期确认 → AI推荐 → 收入建模 → 成本建模 → 达产率配置
```

## 📝 详细步骤说明

### 步骤1：计算期确认

**目的**：确认项目的建设期和运营期，设置预测的时间范围

**操作指南**：
1. 查看建设期（来自项目基本信息，不可修改）
2. 调整运营期（可根据实际需要修改）
3. 确认计算期总计（建设期 + 运营期）
4. 点击"确认计算期"按钮

**建议**：
- 工业项目运营期：10-20年
- 基础设施项目：20-30年
- 高新技术项目：5-10年

---

### 步骤2：AI推荐营收结构

**目的**：基于项目信息，AI智能推荐适合的营收项目结构

**操作指南**：
1. 系统自动调用AI推荐引擎
2. 查看推荐的收入项分类和明细
3. 勾选需要采纳的推荐项
4. 点击"应用选中的推荐"按钮

**AI推荐规则**：
- **数字平台**：包含关键词（云平台、SaaS、AI、智能）
  - 推荐：SaaS平台会员费、API调用费、AI增值服务费
- **农业种植**：包含关键词（种植、农田、果树、甘蔗）
  - 推荐：农产品销售收入、种苗销售收入
- **制造业**：包含关键词（生产、制造、加工、车间）
  - 推荐：产品销售收入
- **服务业**：包含关键词（服务、咨询、培训）
  - 推荐：服务费收入

---

### 步骤3：收入建模

**目的**：配置各项营业收入的详细参数

**操作指南**：

#### 3.1 新增收入项
1. 点击"新增收入项"按钮
2. 填写收入项名称
3. 选择收入类别（数字平台/农业种植/制造业/服务业/房地产/其他）
4. 选择字段模板（决定需要填写的参数）
5. 填写相关参数
6. 设置增值税率
7. 点击"保存"

#### 3.2 字段模板说明

| 模板类型 | 适用场景 | 需填参数 | 计算公式 |
|---------|---------|---------|---------|
| **数量 × 单价** | 标准产品销售 | 数量、单价 | 含税收入 = 数量 × 单价 |
| **面积 × 亩产量 × 单价** | 农业种植 | 面积、亩产量、单价 | 含税收入 = 面积 × 亩产量 × 单价 |
| **产能 × 利用率 × 单价** | 制造业 | 产能、利用率、单价 | 含税收入 = 产能 × 利用率 × 单价 |
| **订阅数 × 单价** | SaaS订阅服务 | 订阅数、单价 | 含税收入 = 订阅数 × 单价 |
| **直接金额** | 其他收入 | 金额 | 含税收入 = 金额 |

#### 3.3 自动计算

系统会自动计算并显示：
- **含税收入**：根据参数计算的含税销售额
- **不含税收入**：含税收入 ÷ (1 + 增值税率)
- **增值税金额**：含税收入 - 不含税收入

#### 3.4 编辑和删除
- 点击收入项行的"编辑"按钮可修改参数
- 点击"删除"按钮可移除收入项

---

### 步骤4：成本建模

**目的**：配置各项营业成本的参数

**状态**：🚧 功能开发中，敬请期待

---

### 步骤5：达产率配置

**目的**：设置各运营年度的产能释放比例

**操作指南**：

#### 5.1 理解达产率
达产率表示项目各运营年度的产能释放比例，影响实际营业收入：
- 第1年通常为 50%（项目刚投产，产能未完全释放）
- 第2年通常为 75%（产能逐步提升）
- 第3年及以后为 100%（达到设计产能）

#### 5.2 选择模板
系统提供4种达产率模板：

| 模板名称 | 适用场景 | 达产规律 |
|---------|---------|---------|
| **默认模板** | 常规项目 | 第1年50% → 第2年75% → 第3年100% |
| **线性增长** | 渐进式达产 | 从50%线性增长到100% |
| **快速达产** | 成熟技术项目 | 第1年80% → 第2年100% |
| **S型曲线** | 复杂项目 | 缓慢启动 → 快速增长 → 平稳达产 |

#### 5.3 手动调整
- 直接在表格中修改各年度的达产率
- 系统实时显示进度条和统计信息
- 点击"应用更改"保存配置

#### 5.4 统计信息
系统自动计算并显示：
- **平均达产率**：所有年度的平均值
- **首年达产率**：第1年的达产率
- **满产年份**：首次达到100%的年份

---

## 💡 使用技巧

### 1. 数据校验

系统内置完整的数据校验功能：

**收入项校验**：
- ✅ 名称不能为空
- ✅ 增值税率必须在0-100%之间
- ✅ 根据字段模板验证必填参数
- ✅ 计算结果必须大于0

**达产率校验**：
- ✅ 年份数量必须匹配运营期
- ✅ 达产率必须在0-100%之间
- ✅ 不允许重复年份
- ⚠️ 达产率不建议逐年下降

**交叉校验**：
- ⚠️ 成本占收入比例过高时会提示（>95%）
- ⚠️ 达产率异常下降时会提示

### 2. 常见增值税率参考

| 行业/产品类型 | 增值税率 | 说明 |
|--------------|---------|------|
| 有形动产销售 | 13% | 一般纳税人标准税率 |
| 农产品销售 | 9% | 农产品、粮食等 |
| 服务业 | 6% | 现代服务业、增值电信 |
| 出口货物 | 0% | 享受出口退税政策 |

### 3. 保存和导出

**自动保存**：
- 系统会自动保存所有配置到数据库
- 每次修改后点击"应用更改"即可保存

**数据持久化**：
- 收入项配置 → revenue_items表
- 成本项配置 → cost_items表
- 达产率配置 → production_rates表
- 完整模型数据 → revenue_cost_estimates表

---

## 🔧 技术架构

### 前端技术栈
- **UI框架**：React 18 + TypeScript + Vite
- **组件库**：Mantine UI
- **状态管理**：Zustand
- **数据校验**：ValidationService

### 后端技术栈
- **API框架**：Node.js + Express
- **数据库**：MariaDB 10.x
- **数据验证**：Zod

### 核心组件

| 组件名称 | 文件路径 | 功能说明 |
|---------|---------|---------|
| RevenueCostModeling | /pages/RevenueCostModeling.tsx | 主页面组件 |
| PeriodConfirmation | /components/revenue-cost/PeriodConfirmation.tsx | 计算期确认 |
| AIRecommendationEngine | /components/revenue-cost/AIRecommendationEngine.tsx | AI推荐引擎 |
| DynamicRevenueTable | /components/revenue-cost/DynamicRevenueTable.tsx | 动态收入表格 |
| ProductionRateModel | /components/revenue-cost/ProductionRateModel.tsx | 达产率配置 |
| revenueCostStore | /stores/revenueCostStore.ts | Zustand状态管理 |
| validationService | /services/validationService.ts | 数据校验服务 |

---

## ❓ 常见问题

### Q1: 为什么"收入及成本预测"按钮被禁用？
**A**: 当差距率 ≥ 1.5% 时，说明投资估算的精度不够，需要先优化投资估算，使差距率降到1.5%以下。

### Q2: AI推荐没有返回结果怎么办？
**A**: 
1. 检查项目信息是否包含有效的关键词
2. 可以手动添加收入项，不依赖AI推荐
3. 点击"重新推荐"按钮重试

### Q3: 如何修改已添加的收入项？
**A**: 在收入建模页面，点击收入项行的"编辑"按钮，在弹出的对话框中修改参数后保存。

### Q4: 达产率配置有什么注意事项？
**A**: 
1. 首年达产率一般为50%-80%
2. 建议逐年递增，不要出现大幅下降
3. 第3年及以后通常达到100%
4. 可根据项目实际情况灵活调整

### Q5: 数据会自动保存吗？
**A**: 不会自动保存。需要在修改后点击"应用更改"或"保存"按钮才会保存到数据库。

---

## 📞 技术支持

如遇到问题或需要帮助，请联系：
- **技术支持邮箱**：support@example.com
- **开发团队**：Solution Assistant Team

---

## 📅 更新日志

### v1.0.0 (2025-12-14)
- ✅ 完成计算期确认功能
- ✅ 完成AI推荐引擎
- ✅ 完成动态收入表格
- ✅ 完成达产率模型配置
- ✅ 完成数据校验服务
- ✅ 完成后端API接口
- ✅ 完成数据库设计

### 计划中功能
- 🚧 成本建模功能
- 🚧 利润税金计算
- 🚧 数据导出Excel
- 🚧 可视化图表展示

---

**© 2025 Solution Assistant. All rights reserved.**
