# 利润税金表格测试指南

## 功能概述
利润税金表格是收入及成本预测模块的第4步，用于展示项目的现金流量分析和税金计算。

## 测试步骤

### 1. 访问应用程序
- 前端地址：http://localhost:5174/
- 后端地址：http://localhost:3001/

### 2. 登录系统
- 使用测试账号登录：
  - 管理员：admin / 123456
  - 用户：user / 123456

### 3. 选择项目
- 从项目列表中选择一个已有项目，或创建新项目
- 确保项目已完成投资估算（需要投资估算数据才能正常显示利润税金表格）

### 4. 导航到收入及成本预测
- 在项目详情页面，点击"收入及成本预测"按钮
- 或直接访问：http://localhost:5174/revenue-cost/{项目ID}

### 5. 完成前置步骤
利润税金表格需要前置步骤的数据支持：
1. **基础数据确认** - 确认建设期、运营期等基础参数
2. **AI推荐结构** - 锁定营收结构表
3. **收入建模** - 完成收入数据建模
4. **成本建模** - 完成成本数据建模

### 6. 测试利润税金表格
在步骤4"利润税金"中，验证以下功能：

#### 6.1 表格结构验证
- 表格应包含建设期列（根据项目建设期自动生成）
- 表格应包含运营期列（根据项目运营期自动生成）
- 表格应包含以下行项目：
  - 1 现金流入
  - 1.1 营业收入
  - 1.2 补贴收入
  - 1.3 回收固定资产余值
  - 1.4 回收流动资金
  - 2 现金流出
  - 2.1 建设投资
  - 2.2 流动资金
  - 2.3 经营成本
  - 2.4 增值税、房产税等及附加
  - 2.5 维持运营投资
  - 3 所得税前净现金流量（1-2）
  - 4 累计所得税前净现金流量
  - 5 调整所得税
  - 6 所得税后净现金流量
  - 7 累计所得税后净现金流量

#### 6.2 数据计算验证
- 验证各项数据的计算逻辑是否正确
- 检查累计值的计算是否准确
- 确认所得税计算是否基于正确的利润基数

#### 6.3 Excel导出功能
- 点击"导出Excel"按钮
- 验证导出的Excel文件是否包含完整的表格数据
- 检查Excel文件的格式和样式是否正确

#### 6.4 数据刷新功能
- 修改前置步骤的数据（如收入或成本）
- 返回利润税金表格，验证数据是否自动更新
- 确认计算结果是否反映最新的数据变更

## 预期结果

### 成功情况
- 表格正确显示所有行项目和列
- 数据计算准确无误
- Excel导出功能正常工作
- 数据能够实时更新

### 可能的问题
- 如果缺少投资估算数据，表格可能显示不完整
- 如果前置步骤未完成，某些计算可能为0或空值
- 数据格式可能需要进一步调整

## 技术实现细节

### 组件位置
- 组件文件：`client/src/components/revenue-cost/ProfitTaxTable.tsx`
- 集成位置：`client/src/pages/RevenueCostModeling.tsx` (步骤4)

### 数据依赖
- 投资估算数据（用于建设投资和固定资产余值计算）
- 收入数据（用于营业收入计算）
- 成本数据（用于经营成本计算）
- 还本付息计划表（用于利息计算）
- 折旧摊销表（用于折旧计算）

### 计算逻辑
- 所得税前净现金流量 = 现金流入 - 现金流出
- 调整所得税基于利润总额计算
- 所得税后净现金流量 = 所得税前净现金流量 - 调整所得税

## 测试完成标准
- [ ] 表格结构完整，包含所有要求的行和列
- [ ] 数据计算准确，符合财务分析要求
- [ ] Excel导出功能正常
- [ ] 数据能够根据前置步骤变化实时更新
- [ ] 界面美观，用户体验良好