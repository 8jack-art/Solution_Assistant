# 投资估算简表数据加载Bug修复测试指南

## 测试环境准备

### 1. 启动后端服务
```bash
cd server
npm run dev
```
确保后端服务正常运行在 http://localhost:3001

### 2. 启动前端服务
```bash
cd client
npm run dev
```
确保前端服务正常运行在 http://localhost:5173

### 3. 登录系统
访问 http://localhost:5173，使用有效的用户名和密码登录

## 测试用例执行指南

### 测试用例1：首次加载"投资估算简表"模块
**测试步骤：**
1. 登录后，点击任意项目进入"投资估算简表"模块
2. 观察数据加载过程
3. 检查数据是否正常显示

**预期结果：**
- ✅ 数据加载成功，显示加载动画
- ✅ 数据正常显示，无错误提示
- ✅ 控制台无错误信息

**修复验证：**
- 检查是否使用了缓存机制
- 检查是否有请求重试机制

---

### 测试用例2：从"收入及成本预测"返回"投资估算简表"
**测试步骤：**
1. 进入"投资估算简表"模块，等待数据加载完成
2. 点击导航栏进入"收入及成本预测"模块
3. 等待"收入及成本预测"模块数据加载完成
4. 点击返回按钮或导航栏返回"投资估算简表"模块
5. 观察数据加载过程和结果

**预期结果：**
- ✅ 数据加载成功，显示加载动画
- ✅ 数据正常显示，无错误提示
- ✅ 控制台无错误信息
- ✅ 加载速度较快（可能使用缓存）

**修复验证：**
- 检查是否有缓存机制生效
- 检查是否有请求取消机制
- 检查是否有竞态条件处理

---

### 测试用例3：快速连续切换模块
**测试步骤：**
1. 进入"投资估算简表"模块
2. 立即切换到"收入及成本预测"模块
3. 立即切换回"投资估算简表"模块
4. 重复上述操作5-10次
5. 观察数据加载过程和结果

**预期结果：**
- ✅ 每次切换都能正常加载数据
- ✅ 无数据加载失败的情况
- ✅ 控制台无错误信息
- ✅ 无内存泄漏警告

**修复验证：**
- 检查是否有请求取消机制
- 检查是否有竞态条件处理
- 检查是否有内存泄漏防护

---

### 测试用例4：网络不稳定情况下的数据加载
**测试步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到Network标签
3. 设置网络为"Slow 3G"或"Offline"然后恢复
4. 进入"投资估算简表"模块
5. 观察数据加载过程和结果

**预期结果：**
- ✅ 显示重试提示
- ✅ 数据最终加载成功
- ✅ 有友好的错误提示

**修复验证：**
- 检查是否有请求重试机制
- 检查是否有错误处理机制
- 检查是否有友好的错误提示

---

### 测试用例5：缓存失效后的数据加载
**测试步骤：**
1. 进入"投资估算简表"模块，等待数据加载完成
2. 在浏览器开发者工具的Application标签中清除缓存
3. 刷新页面
4. 观察数据加载过程和结果

**预期结果：**
- ✅ 数据重新加载成功
- ✅ 无错误提示
- ✅ 加载速度正常

**修复验证：**
- 检查是否有缓存失效处理
- 检查是否能正常重新加载数据

---

### 测试用例6：并发请求处理
**测试步骤：**
1. 打开多个浏览器标签页
2. 在每个标签页中登录并进入不同的项目
3. 同时在这些标签页中切换到"投资估算简表"模块
4. 观察数据加载过程和结果

**预期结果：**
- ✅ 所有标签页都能正常加载数据
- ✅ 无数据加载失败的情况
- ✅ 控制台无错误信息

**修复验证：**
- 检查是否有并发请求处理
- 检查是否有请求队列管理

---

### 测试用例7：错误恢复机制
**测试步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 在Network标签中阻止API请求（右键 → Block request URL）
4. 进入"投资估算简表"模块
5. 解除阻止，点击重试按钮

**预期结果：**
- ✅ 显示错误提示
- ✅ 有重试按钮
- ✅ 点击重试后数据加载成功

**修复验证：**
- 检查是否有错误边界组件
- 检查是否有重试机制
- 检查是否有友好的错误提示

---

### 测试用例8：长时间等待后的数据加载
**测试步骤：**
1. 进入"投资估算简表"模块，等待数据加载完成
2. 等待10-15分钟（超过缓存TTL时间）
3. 切换到其他模块，再切换回"投资估算简表"模块
4. 观察数据加载过程和结果

**预期结果：**
- ✅ 数据重新加载成功
- ✅ 无错误提示
- ✅ 加载速度正常

**修复验证：**
- 检查是否有缓存过期处理
- 检查是否能正常重新加载数据

---

### 测试用例9：大量数据加载
**测试步骤：**
1. 选择一个数据量较大的项目（建设期和运营期较长的项目）
2. 进入"投资估算简表"模块
3. 观察数据加载过程和结果
4. 检查页面性能

**预期结果：**
- ✅ 数据加载成功
- ✅ 页面响应流畅
- ✅ 无卡顿现象

**修复验证：**
- 检查是否有性能监控
- 检查是否有慢请求记录
- 检查是否有性能优化

---

### 测试用例10：组件卸载和重新挂载
**测试步骤：**
1. 进入"投资估算简表"模块，等待数据加载完成
2. 刷新页面（F5）
3. 观察数据加载过程和结果
4. 重复上述操作多次

**预期结果：**
- ✅ 每次刷新都能正常加载数据
- ✅ 无数据加载失败的情况
- ✅ 控制台无错误信息
- ✅ 无内存泄漏警告

**修复验证：**
- 检查是否有请求取消机制
- 检查是否有内存泄漏防护
- 检查是否有组件卸载清理

---

## 控制台日志检查

### 检查是否有以下日志：
1. **请求取消日志**：
   ```
   Request cancelled due to component unmount
   ```

2. **重试日志**：
   ```
   Retrying request (attempt X/3)...
   ```

3. **缓存命中日志**：
   ```
   Cache hit for investment data
   ```

4. **慢请求日志**：
   ```
   Slow request detected: 3.5s > 3s threshold
   ```

5. **错误日志**：
   ```
   Failed to load investment data: [error details]
   ```

### 检查是否有错误信息：
- ❌ `TypeError: Cannot read property 'xxx' of undefined`
- ❌ `Network Error`
- ❌ `Request failed with status code 500`
- ❌ `Warning: Can't perform a React state update on an unmounted component`

---

## 性能指标检查

### 使用浏览器开发者工具检查：
1. **Network标签**：
   - 检查API请求的响应时间
   - 检查是否有重复请求
   - 检查请求状态码（200表示成功）

2. **Performance标签**：
   - 检查页面加载时间
   - 检查脚本执行时间
   - 检查渲染时间

3. **Memory标签**：
   - 检查内存使用情况
   - 检查是否有内存泄漏

---

## 测试结果记录表

| 测试用例 | 测试日期 | 测试结果 | 问题描述 | 备注 |
|---------|---------|---------|---------|------|
| 测试用例1 | | | | |
| 测试用例2 | | | | |
| 测试用例3 | | | | |
| 测试用例4 | | | | |
| 测试用例5 | | | | |
| 测试用例6 | | | | |
| 测试用例7 | | | | |
| 测试用例8 | | | | |
| 测试用例9 | | | | |
| 测试用例10 | | | | |

---

## 修复效果评估

### 成功标准：
1. ✅ 所有测试用例都能通过
2. ✅ 控制台无错误信息
3. ✅ 数据加载成功率100%
4. ✅ 无内存泄漏
5. ✅ 性能指标达标

### 部分成功标准：
1. ⚠️ 大部分测试用例能通过
2. ⚠️ 偶尔出现数据加载失败（频率<5%）
3. ⚠️ 有少量警告信息

### 失败标准：
1. ❌ 多个测试用例失败
2. ❌ 数据加载失败频率>10%
3. ❌ 有严重错误信息
4. ❌ 有内存泄漏

---

## 后续优化建议

如果测试结果不理想，可以考虑以下优化：

1. **增加缓存时间**：将TTL从5分钟增加到10分钟
2. **增加重试次数**：将重试次数从3次增加到5次
3. **优化数据库查询**：添加索引、优化查询语句
4. **实现请求队列**：避免并发请求过多
5. **添加离线缓存**：使用IndexedDB存储数据
6. **优化组件渲染**：使用React.memo、useMemo等优化

---

## 联系支持

如果测试过程中遇到问题，请记录以下信息：
1. 测试用例编号
2. 具体操作步骤
3. 预期结果
4. 实际结果
5. 控制台错误信息
6. Network请求信息

这些信息将有助于进一步诊断和解决问题。
